var FPDGlobalVariable={aProduct:null,aCustomerElements:null,bSelect:false,bFirst:false,bProductLoaded:false,aCustomerElementsColor:[[],[]],aCustomerImageColor:[[],[]],aCustomerDesignElements:[[],[]],sBaseColor:""};(function(b){var a=function(z,ae){var Y=b.extend({},b.fn.fancyProductDesigner.defaults,ae);Y.elementParameters=b.extend({},b.fn.fancyProductDesigner.defaults.elementParameters,Y.elementParameters);Y.textParameters=b.extend({},b.fn.fancyProductDesigner.defaults.textParameters,Y.textParameters);Y.customTextParameters=b.extend({},b.fn.fancyProductDesigner.defaults.customTextParameters,Y.customTextParameters);Y.customImagesParameters=b.extend({},b.fn.fancyProductDesigner.defaults.customImagesParameters,Y.customImagesParameters);Y.dimensions=b.extend({},b.fn.fancyProductDesigner.defaults.dimensions,Y.dimensions);Y.labels=b.extend({},b.fn.fancyProductDesigner.defaults.labels,Y.labels);Y.labels.colorpicker=b.extend({},b.fn.fancyProductDesigner.defaults.labels.colorpicker,Y.labels.colorpicker);Y.sidebarLabels=b.extend({},b.fn.fancyProductDesigner.defaults.sidebarLabels,Y.sidebarLabels);Y.productStageLabels=b.extend({},b.fn.fancyProductDesigner.defaults.productStageLabels,Y.productStageLabels);var c=this,i,ak,Q,aE,h,ao,aq,K,f,aA,ax,M,ay,am,aB,J,al,l,E,ap,ag,v=null,I=null,ac=0,A=-1,T=null,e=0,af=null,aD=null,t=0,q=1,g=1,az={},O=new Image(),ar=new Image(),w=new Image();O.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QkNGMzVGRDE0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QkNGMzVGRDI0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZDRjQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEMDQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj80kqoAAAHdSURBVHjalFO7agJREB2Xa6Hio1CIEbSIKIidptJOENJYCraBlGnyCX5BiF8gCUEhWClYhQULIaRUFlQEX4VKCp/gczJ3yW5iYsLmwHL3vs7MnDmX1Wo1IJyYTKYrvV5/hgT4AzqdTtjtdm+LxeJxv9+/AhE4x+PxC03wP5jP52NJkqLMaDRe2u328++RVqsV9Ho9oGhgsVjA6XQe7FPGdqvVegPdbjfzlXk6nWI6nUa/349UEgqCgDabDePxOJbLZflMoVDAVquFk8lEhE6nc6tcpn8MhUJcg1+/ZDKJZrMZ6/U6L+NZJaCUMRKJqAcZYxiLxTCVSqHP5/tB1Gw2cTabfRJks1l10+12Y6VSUcvabreYSCQOCBqNhkzAqC2yKLlcTmkTZDIZiEajqmClUgmq1SqQHvJcGTkYn1ALod1uywsulwtIsAPFA4EAiKKoXuRBPB4PkODAjhgFlKwUeL3eo6binhN4dM5MdcuLg8EAqF2gFYLiXGqPPHLCfD6vmYB34Y4rvVwuMRgMYjgcxuFwqMnOo9FIZDTOOJHBYIBisQhkbXA4HJqC87gCvaoH6ueQL3BltV7ebDZAVr7nGUj9fv+CHsY1ue/0wyh/vmjSaU5Bc+v1+uldgAEAQbiBjYjV1d0AAAAASUVORK5CYII=";ar.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RkY3RjhCMTI0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkY3RjhCMTM0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZENzQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEODQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj7soO0AAAG9SURBVHjalFM9awJBEJ07TwstlPMKL4WFVlEsU5lGEMHKQizSSSBlmoA/wH+QP2AlhBSptLESBCtJIyqCH6BgETwFNeeBH+dmdskdhiR3yYMtdnf2zbw3s1y32wVEwOPx3DmdzjBBgAU4juN1XV9ut9un0+n0CkggK4rSIv8APiSqqir9fv9acLvdt5IkXU0mE2g0GsDzPOz3e/D5fJDJZEAQhJ+qAKxYwpgHvBcC9LDZbEI+n2cBsixDuVwGh8NhpYaSizxWpNONy+UyL7AiiEajLJMVqBre2GiaBsFgENLpNHQ6HYjH49But8EOJoEoilAqlaBarUIymYTpdArL5dKWgAY+Gs4aWCwWpNWyb8x8Pq8L584a8Pv9bJ0DE7AO/SrBCrVaDRKJBIxGI7Yfj8es1SypIcFqaHK5HJ1OEolESKVSIalUiux2O4Ie1W0JKFarFclms4yErnCYTTwj4P8iw+v1QqFQMAcL/4JpgYBE73YEw+EQisUixGIxOjwQCoUMYzXo9XqXm83mzUrC4XAgx+PxyxmaSAaDwQ2toD+bzdJY5j3O9sWnzm+f56zNHGZW1+v1M5K8fAgwAKZZlVqllD6aAAAAAElFTkSuQmCC";w.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOEE2RDlFMzNBNzM3REJDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFQTNDNjY0RUUwRTcxMUUzQjIzMjgwOEVFRDlEQzYzRCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFQTNDNjY0REUwRTcxMUUzQjIzMjgwOEVFRDlEQzYzRCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAyODAxMTc0MDcyMDY4MTE4QTZEOUUzM0E3MzdEQkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE4QTZEOUUzM0E3MzdEQkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+LSpQ5wAAAbtJREFUeNqUUztrAkEQnju1slBSiKaxOCwOEUkfRP+A4KM5G21S5hekNajYpLO2CSlCythZWYVgpQgioiIYPdP4fm9mj9zixjMkHxzHzM58O/PNjlCr1QDhtFqtNxaLRSII+AWCIIj7/f5zPp8/Hg6Hd0ACl6qqb2iQv4LGzmYztdFoXEO73b47PhyPx2cTt9stWSwWzB4MBi+i2Wx26uWVy2Xw+/2QTqdPSl+v1xCJRCAQCECv19N8mHsB3W73QWcMhUK0f+3L5XLsptVqReLxODvLZDKafzQalTmCVqtFvF4vC8zn82Q6nZJoNMp8iURC8xkSUHQ6HY7E4/FwyVQHHYYEFP1+n6AWLJF+yWSS4Pi4OEogGs3a5XKBw+HgfJIkgSgahP+sYLlcknA4zG5GpU/EO9sCPg4uOZVKkWq1ymmSzWbPE8RiMU6w3W7HhJVlmZ0VCgVOA9ZYMBjU/oqiQLFYBJPJpNlutxtKpRLgRMBut4PP59NTRED2++O+KpWK9nCMQCvB3WH2cDh8hXq9Lk8mkw/yT2w2G9JsNhWBrjOO58pms92i4pffff660biNM3yNT0jy/CXAACPMXDtDjD7PAAAAAElFTkSuQmCC";Q=b(z).addClass("fpd-container fpd-clearfix fpd-"+Y.layout+"").before('<p class="fpd-initiliazing">'+Y.labels.initText+'<br /><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSJibGFjayI+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4IDApIiBjeD0iMCIgY3k9IjE2IiByPSIwIj4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiAwKSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJyIiB2YWx1ZXM9IjA7IDQ7IDA7IDAiIGR1cj0iMS4ycyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGJlZ2luPSIwLjMiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNCAwKSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJyIiB2YWx1ZXM9IjA7IDQ7IDA7IDAiIGR1cj0iMS4ycyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGJlZ2luPSIwLjYiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+Cjwvc3ZnPg==" /></p>');ak=Q.prev(".fpd-initiliazing");al=Q.children(".fpd-product").remove();l=Q.children(".fpd-design");if(Y.layout=="icon-sb-top"||Y.layout=="icon-sb-bottom"){Q.addClass("fpd-horizontal")}var D=document.createElement("canvas"),N=Boolean(D.getContext&&D.getContext("2d"));if(!N){b.post(Y.templatesDirectory+"_canvaserror",function(n){Q.append(b.parseHTML(n));Q.trigger("templateLoad",[this.url])});ak.remove();Q.trigger("canvasFail").fadeIn(500);return false}window.localStorage.length;fabric.Canvas.prototype.cursorMap=["default","default","default","default","default","default","default","default"];var ad,G=Object.keys(Y.hexNames),L=G.length,C={};while(L--){ad=G[L];C[ad.toLowerCase()]=Y.hexNames[ad]}Y.hexNames=C;aE=Q.children(".fpd-sidebar");h=aE.children(".fpd-navigation");ao=aE.children(".fpd-content");aA=ao.find(".fpd-toolbar");ax=aA.find(".fpd-helper-buttons-wrapper");M=aA.find(".fpd-color-picker");am=aA.find(".fpd-patterns-wrapper");aB=aA.find(".fpd-curved-text-wrapper");if(Y.layout!="semantic"){if(Q.hasClass("fpd-horizontal")){aE.css("width",Y.dimensions.sidebarSize);h.find(".fpd-nav-item").css("line-height",Y.dimensions.sidebarNavSize+"px");h.css("height",Y.dimensions.sidebarNavSize)}else{aE.css("height",Y.dimensions.sidebarSize);h.css("width",Y.dimensions.sidebarNavSize);ao.css("width",Y.dimensions.sidebarContentWidth)}}else{aE.css("width",Y.dimensions.sidebarSize)}aq=Q.children(".fpd-product-container").width(Y.dimensions.productStageWidth);K=aq.children(".fpd-product-stage").height(Y.dimensions.productStageHeight);J=K.children(".fpd-element-tooltip").html(Y.labels.outOfContainmentAlert);f=aq.children(".fpd-menu-bar").addClass("fpd-"+Y.menubarPosition);ag=aq.append('<div class="fpd-product-loader"><div class="fpd-loading"></div></div>').children(".fpd-product-loader").hide();setTimeout(function(){ai()},200);var ai=function(){var aG=K.children("canvas").get(0);i=new fabric.Canvas(aG,{selection:false,hoverCursor:"pointer",rotationCursor:"default",controlsAboveOverlay:true,centeredScaling:true});i.setDimensions({width:aq.width(),height:Y.dimensions.productStageHeight});if(Y.tooltips){b(".fpd-tooltip").each(function(){var aX=b(this);if(aX.attr("tip-postion")){aX.tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",position:aX.attr("tip-postion"),touchDevices:false})}else{aX.tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",touchDevices:false})}})}i.on({"mouse:down":function(aY){if(aY.target==undefined){c.deselectElement()}else{var aZ=i.getPointer(aY.e),aX=aY.target.findTargetCorner(aZ);if(aX=="tr"&&aD.params.removable){c.removeElement(aD)}}},"text:changed":function(aX){u(aX.target,aX.target.text)},"object:moving":function(aX){if((aD&&aD.params.draggable)||Y.editorMode){aD.params.x=Math.round(aX.target.left/q);aD.params.y=Math.round(aX.target.top/q);av(aD);V(aD)}},"object:scaling":function(aX){if((aD&&aD.params.resizable)||Y.editorMode){aD.params.scale=Number(aX.target.scaleX/q).toFixed(2);aX.target.setCoords();av(aD);V(aD)}},"object:rotating":function(aX){if((aD&&aD.params.rotatable)||Y.editorMode){aD.params.degree=Math.round(aX.target.angle/q);av(aD);V(aD)}},"object:selected":function(a0){c.deselectElement(false);aD=a0.target;var a2=aD.params;if(aD.params.uploadZone&&!Y.editorMode){aD.set("borderColor","transparent");f.find(".fpd-input-image").data("fpd-placeholder",aD.title).click();return false}aD.set({borderColor:Y.selectedColor,cornerColor:"transparent",cornerSize:16,rotatingPointOffset:0,padding:aD.type=="text"||aD.type=="i-text"?Y.paddingControl:0});ao.find(".fpd-elements-dropdown").children('option[value="'+aD.id+'"]').prop("selected",true).parent().trigger("chosen:updated");if(((Array.isArray(a2.colors)&&s(aD)!=false))||aD.type=="path-group"){if(aD.type=="path-group"){for(var aZ=0;aZ<aD.paths.length;++aZ){var a1=aD.paths[aZ],aY=tinycolor(a1.fill);M.append('<input type="text" value="'+aY.toHexString()+'" />')}M.addClass("fpd-colorpicker-group").find("input").spectrum({hexNames:Y.hexNames,preferredFormat:"hex",showInput:true,chooseText:Y.labels.colorpicker.change,cancelText:Y.labels.colorpicker.cancel,change:function(a5){var a3=M.find("input").index(this);aD.paths[a3].setFill(a5.toHexString());i.renderAll();var a4=[];for(var a6=0;a6<aD.paths.length;++a6){var a7=aD.paths[a6],a5=tinycolor(a7.fill);a4.push(a5.toHexString())}aD.params.currentColor=a4}});if(Y.layout=="semantic"){M.removeClass("ui button");M.children("div").addClass("ui button")}}else{M.append('<input type="text" value="'+(a2.currentColor?a2.currentColor:a2.colors[0])+'" />');if(a2.colors.length>1){M.find("input").spectrum({hexNames:Y.hexNames,preferredFormat:"hex",showPaletteOnly:true,showPalette:true,palette:a2.colors,chooseText:Y.labels.colorpicker.change,cancelText:Y.labels.colorpicker.cancel,change:function(a3){B(aD,a3.toHexString())}})}else{M.find("input").spectrum("destroy").spectrum({hexNames:Y.hexNames,preferredFormat:"hex",showInput:true,chooseText:Y.labels.colorpicker.change,cancelText:Y.labels.colorpicker.cancel,change:function(a3){B(aD,a3.toHexString())}})}}M.css("display","block").parent("div").show()}else{M.hide().parent("div").hide()}if(aD.type=="i-text"||aD.type=="curvedText"){if(ay){ay.children('option[value="'+a2.font+'"]').prop("selected",true).trigger("chosen:updated");ay.parent().show()}aA.find(".fpd-text-styles").show().parent("div").show();if(a2.patternable&&Y.patterns.length){am.show().parent("div").show()}if(a2.curved||a2.curvable){aB.show();aB.find(".fpd-curved-text-radius").val(a2.curveRadius);aB.find(".fpd-curved-text-spacing").val(a2.curveSpacing);if(a2.curvable){if(a2.curved){aB.find(".fpd-curve-toggle").removeClass("fpd-button-submit green").addClass("fpd-button-danger red").children("i").removeClass("fa-check").addClass("fa-times");aB.find(".fpd-curve-toggle-item").show()}else{aB.find(".fpd-curve-toggle").removeClass("fpd-button-danger red").addClass("fpd-button-submit green").children("i").removeClass("fa-times").addClass("fa-check");aB.find(".fpd-curve-toggle-item").hide()}aB.find(".fpd-curve-toggle").show()}}if(a2.editable){aA.children(".fpd-text-format-section").find("textarea").val(aD.getText()).show()}else{aA.children(".fpd-text-format-section").find("textarea").hide()}}a2.draggable?ax.children(".fpd-center-horizontal, .fpd-center-vertical").show():ax.children(".fpd-center-horizontal, .fpd-center-vertical").hide();a2.zChangeable?ax.children(".fpd-move-down, .fpd-move-up").show():ax.children(".fpd-move-down, .fpd-move-up").hide();a2.removable?ax.children(".fpd-trash").show():ax.children(".fpd-trash").hide();if(a2.boundingBox&&!Y.editorMode){var aX=c.getBoundingBoxCoords(aD);if(aX){I=new fabric.Rect({left:aX.left,top:aX.top,width:aX.width,height:aX.height,stroke:Y.boundingBoxColor,strokeWidth:Y.boundingBoxBorderWidth,fill:false,selectable:false,evented:false,originX:"left",originY:"top",name:"bounding-box",params:{x:aX.left,y:aX.top,scale:1}});i.add(I);I.bringToFront()}}i.renderAll().calcOffset();aA.css("visibility","visible");h.find('[data-target=".fpd-edit-elements"]').click();b(window).resize();av(aD);V(aD);Q.trigger("elementSelect",[aD])}});var aK=[];for(var aR=0;aR<al.length;++aR){aK=b(al.get(aR)).children(".fpd-product");aK.splice(0,0,al.get(aR));var aT=[];aK.each(function(aZ,aY){var a0=b(aY);var aX={title:aY.title,category:a0.data("category"),thumbnail:a0.data("thumbnail"),desc:a0.data("desc"),diyeditarea:a0.data("diyeditarea"),elements:[]};a0.children("img,span").each(function(a3,a4){var a2=b(a4),a5;if(a2.is("img")){a5=a2.data("src")==undefined?a2.attr("src"):a2.data("src")}else{a5=a2.text()}var a1={type:a2.is("img")?"image":"text",source:a5,title:a2.is("img")?a2.attr("title"):a2.text(),parameters:a2.data("parameters")==undefined?{}:a2.data("parameters")};aX.elements.push(a1)});aT.push(aX)});c.addProduct(aT)}if(l.size()>0){if(l.children(".fpd-category").length>0){v=ao.parent().find(".fpd-designs").prepend('<select class="fpd-design-categories" tabindex="1"></select>').children(".fpd-design-categories").change(function(){var aX=az[this.value];ao.parent().find(".fpd-designs .fpd-items-wrapper > picture").remove();for(var aY=0;aY<aX.length;++aY){W(aX[aY])}b(this).trigger("chosen:updated")});l.children(".fpd-category").each(function(aZ,aX){var aY=b(aX),a0=aY.data("parameters")?aY.data("parameters"):{};aY.children("img").each(function(a2,a1){var a3=b(a1);c.addDesign(a3.data("src")==undefined?a3.attr("src"):a3.data("src"),a3.attr("title"),b.extend({},a0,a3.data("parameters")),aX.title,a3.data("thumbnail"))})});if(Y._useChosen){v.chosen()}v.change()}else{var aW=l.children("img");for(var aR=0;aR<aW.length;++aR){var aN=b(aW[aR]);c.addDesign(aN.data("src")==undefined?aN.attr("src"):aN.data("src"),aN.attr("title"),aN.data("parameters"),false,aN.data("thumbnail"))}}l.remove()}h.find('[data-target=".fpd-edit-elements"]').css("display","inline-block");if(Y.customTexts){f.find(".fpd-add-text").click(function(aX){aX.preventDefault();c.addElement("text",Y.defaultText,Y.defaultText,Y.customTextParameters,e)}).show()}var aS=f.find(".fpd-input-image");f.find(".fpd-add-image").click(function(aX){aX.preventDefault();aS.click()});f.find(".fpd-upload-form").on("change",function(aZ){if(window.FileReader){var aY=new FileReader();var aX=aZ.target.files[0].name;aY.readAsDataURL(aZ.target.files[0]);aY.onload=function(a0){c.addCustomImage(a0.target.result,aX,1,1)}}else{alert("FileReader API????????????????????????,?????????Firefox???Safari???Chrome???IE10?????????!");aS.data("fpd-placeholder","")}aS.val("")});if(Y.uploadDesigns){f.find(".fpd-add-image").show()}if(Y.facebookAppId&&Y.facebookAppId.length>0){var aU=ao.children(".fpd-fb-user-photos"),aO=aU.find("select").hide(),aF=aU.find(".fpd-items-wrapper"),aJ=aU.find(".fpd-loading");h.find('[data-target=".fpd-fb-user-photos"]').css("display","inline-block");if(Y._useChosen){aO.chosen()}var aI=aU.find(".fpd-fb-user-albums").change(function(){aJ.show();var aX=b(this).children("option:selected").val();aF.css("visibility","hidden").children("picture").remove();FB.api("/"+aX,function(aY){var aZ=aY.count;FB.api("/"+aX+"?fields=photos.limit("+aZ+")",function(a0){if(!a0.error){var a4=a0.photos.data;for(var a2=0;a2<a4.length;++a2){var a1=a4[a2],a3=a1.images[a1.images.length-1]?a1.images[a1.images.length-1].source:a1.source;aF.append('<picture><span class="fpd-loading"></span><img src="'+a3+'" title="'+a1.id+'" data-picture="'+a1.source+'" style="display: none;" /></picture>').children("picture:last").click(function(a5){a5.preventDefault();ag.show();var a6=b(this).children("img");b.post(Y.phpDirectory+"get_image_data_url.php",{url:a6.data("picture")},function(a8){if(a8&&a8.error==undefined){var a7=new Image();a7.src=a8.data_url;a7.onload=function(){Y.customImagesParameters.scale=c.getScalingByDimesions(this.width,this.height,Y.customImagesParameters.resizeToW,Y.customImagesParameters.resizeToH);c.addElement("image",this.src,a6.attr("title"),Y.customImagesParameters,e)}}else{alert(a8.error)}ag.hide()},"json").fail(function(a7){ag.hide();alert(a7.statusText)})}).children("img").load(function(){b(this).fadeIn(500).prev("span").fadeOut(300,function(){b(this).remove();aC(aF)})}).error(function(){b(this).parent().remove()})}aF.css("visibility","visible")}aJ.hide()})})});b.ajaxSetup({cache:true});b.getScript("//connect.facebook.com/en_US/sdk.js",function(){FB.init({appId:Y.facebookAppId,status:true,cookie:true,xfbml:true,version:"v2.0"});FB.Event.subscribe("auth.statusChange",function(aX){if(aX.status==="connected"){aJ.show();FB.api("/me/albums",function(aZ){var a0=aZ.data;for(var a1=0;a1<a0.length;++a1){var aY=a0[a1];aI.append('<option value="'+aY.id+'">'+aY.name+"</option>")}if(aI.next(".chosen-container").size()){aI.trigger("chosen:updated").next(".chosen-container").show()}else{aI.show()}aJ.hide()})}else{aF.css("visibility","hidden").children("picture").remove();aO.children("option:not(:first)").remove();aO.hide().trigger("chosen:updated").next(".chosen-container").hide()}})})}var aM=function(aZ){var a1="_uploadDesignImage";var aY=new FormData();aY.append("filedata",aZ);aY.append("clothingstyle",FPDGlobalVariable.sClothingstyle);var a0=new XMLHttpRequest();a0.open("post",a1,true);a0.onload=function(a3){if(this.status==200){var a2=JSON.parse(a3.target.responseText);if(a2.code==200){if(a2.width*a2.height>=600000){c.addCustomImage(GlobalConfigUrl.corurl+"/"+a2.url,aZ.name,a2.rgb,a2.url,a2.width,a2.height,a2.photo)}else{layer.alert("????????????????????????dpi??????????????????????????????????????????????????????????????????????????????????????????????????????????????????4000-100-978???????????????????????????????????????????????????60?????????(???????????????"+a2.width*a2.height+")???")}}else{layer.alert(a2.data)}}else{layer.alert("??????????????????????????????")}ao.parent().find(".customerimage").prop("disabled",false);aX.text("????????????")};a0.onerror=function(a2){ao.parent().find(".customerimage").prop("disabled",false);aX.text("????????????")};ao.parent().find(".customerimage").prop("disabled",true);var aX=ao.parent().find(".span-addimg").text("????????????...");a0.send(aY)};if(true){var aH=ao.parent().find(".customerimage");ao.parent().on("change",".customerimage",function(aX){var aY=aX.target.files[0];if(/.jpg$/i.test(aY.name)||/.jpeg$/i.test(aY.name)||/.png$/i.test(aY.name)){if(aY.size>10485760){layer.alert("????????????????????????10MB");return false}aM(aY);this.outerHTML=this.outerHTML}else{layer.alert("?????????PNG???JPG???????????????")}})}if(true){var aP=ao.parent().find(".operate-text");aP.on("click",function(aX){c.addElement("text",Y.defaultText,Y.defaultText,Y.customTextParameters,e);return false})}if(Y.instagramClientId.length){h.find('[data-target=".fpd-instagram-photos"]').css("display","inline-block");ao.children(".fpd-instagram-photos").find(".fpd-insta-feed, .fpd-insta-recent-images").click(function(aX){aX.preventDefault();var aY=b(this),aZ=aY.hasClass("fpd-insta-feed")?"feed":"recent";if(window.localStorage.getItem("fpd_instagram_access_token")==null){aw(function(){aa(aZ)})}else{aa(aZ)}})}if(Y.zoomFactor>1){f.find(".fpd-zoom-in, .fpd-zoom-out, .fpd-zoom-reset").click(function(){var aX=b(this);if(aX.hasClass("fpd-zoom-in")){c.zoomIn()}else{if(aX.hasClass("fpd-zoom-out")){c.zoomOut()}else{c.zoomReset()}}}).show()}else{f.find(".fpd-zoom-in, .fpd-zoom-out, .fpd-zoom-reset").hide()}if(Y.allowProductSaving&&Q.attr("id")){f.find(".fpd-save-product, .fpd-saved-products").show();b(".save-btn").click(function(aX){aX.preventDefault();c.deselectElement();var a0=c.getProduct(false),a3=c.getViewsDataURL("png","transparent",0.1)[0];var aZ=P();if(aZ==null){aZ=new Array()}aZ.push({thumbnail:a3,product:a0});try{window.localStorage.setItem(Q.attr("id")+sVerision,JSON.stringify(aZ))}catch(a1){for(var aY=0;aY<a0[0].elements.length;aY++){var a2=a0[0].elements[aY];if(a2.parameters&&a2.parameters.imgid&&a2.parameters.imgid.indexOf("uploads/")>-1&&a2.parameters.imgid.indexOf(".")>-1){a0[0].elements.splice(aY,1);aY-=1}}for(aY=0;aY<a0[1].elements.length;aY++){var a2=a0[1].elements[aY];if(a2.parameters&&a2.parameters.imgid&&a2.parameters.imgid.indexOf("uploads/")>-1&&a2.parameters.imgid.indexOf(".")>-1){a0[1].elements.splice(aY,1);aY-=1}}try{window.localStorage.setItem(Q.attr("id")+sVerision,JSON.stringify(aZ))}catch(a1){return false}}an(a3,a0);layer.tips("?????????????????????????????????",b(".save-list"),{guide:2,time:3,more:true})});var aQ=P();if(aQ!=null){for(var aR=0;aR<aQ.length;++aR){var aV=aQ[aR];an(aV.thumbnail,aV.product)}}}if(Y.saveAsPdf&&window.jsPDF){f.find(".fpd-save-pdf").click(function(aX){aX.preventDefault();c.deselectElement();var aY=i.getWidth()>i.getHeight()?"l":"p";var a1=new jsPDF(aY,"mm",[Y.dimensions.productStageWidth*0.26,Y.dimensions.productStageHeight*0.26]),a0=c.getViewsDataURL("jpeg","white");for(var aZ=0;aZ<a0.length;++aZ){a1.addImage(a0[aZ],"JPEG",0,0);if(aZ<a0.length-1){a1.addPage()}}a1.save("Product.pdf")}).show()}ao.find(".fpd-elements-dropdown").change(function(){if(this.value=="none"){c.deselectElement()}else{var aY=i.getObjects();for(var aX=0;aX<aY.length;++aX){if(aY[aX].id==this.value){i.setActiveObject(aY[aX]);break}}}});if(Y.fonts.length>0){ay=aA.find(".fpd-fonts-dropdown").change(function(){var aX=aD.getWidth();aD.setFontFamily(this.value);aD.params.font=this.value;U(this.value);av(aD);i.renderAll();ay.trigger("chosen:updated")});Y.fonts.sort();for(var aR=0;aR<Y.fonts.length;++aR){var aL=Y.fonts[aR].indexOf(":")==-1?Y.fonts[aR]:Y.fonts[aR].substring(0,Y.fonts[aR].indexOf(":"));if(ay.children('option[value="'+aL+'"]').size()==0){ay.append('<option value="'+aL+'" style="font-family: '+aL+';">'+aL+"</option>")}}if(Y._useChosen){ay.chosen({width:"100%"})}}aA.find(".fpd-text-styles").children().click(function(aX){aX.preventDefault();var aY=b(this);if(aY.hasClass("fpd-align-left")){aD.setTextAlign("left");aD.params.textAlign="left"}else{if(aY.hasClass("fpd-align-center")){aD.setTextAlign("center");aD.params.textAlign="center"}else{if(aY.hasClass("fpd-align-right")){aD.setTextAlign("right");aD.params.textAlign="right"}else{if(aY.hasClass("fpd-bold")){at(aD,"fontWeight",aD.getFontWeight()=="bold"?"":"bold")}else{if(aY.hasClass("fpd-italic")){at(aD,"fontStyle",aD.getFontStyle()=="italic"?"":"italic")}else{if(aY.hasClass("fpd-strikethrough")){at(aD,"textDecoration",aD.params.textDecoration=="line-through"?"":"line-through")}else{if(aY.hasClass("fpd-underline")){at(aD,"textDecoration",aD.params.textDecoration=="underline"?"":"underline")}}}}}}}if(aD.type=="curvedText"){aD.setFill(aD.fill)}i.renderAll()});aB.find(".fpd-curved-text-radius").on("change keyup",function(){aD.set("radius",this.value);aD.params.curveRadius=this.value;av(aD);i.renderAll()});aB.find(".fpd-curved-text-spacing").on("change keyup",function(){aD.set("spacing",this.value);aD.params.curveSpacing=this.value;av(aD);i.renderAll()});aB.find(".fpd-curve-reverse").click(function(){aD.set("reverse",!aD.reverse);aD.params.curveReverse=aD.reverse;i.renderAll()});aB.find(".fpd-curve-toggle").click(function(){var a0=o(aD),aX=aD.getText(),aZ=aD.params;aZ.z=a0;aZ.curved=aD.type=="i-text";function aY(a1,a2){i.setActiveObject(a2);Q.off("elementAdded",aY)}Q.on("elementAdded",aY);c.removeElement(aD);c.addElement("text",aX,aX,aZ)});if(Y.patterns&&Y.patterns.length>0){for(var aR=0;aR<Y.patterns.length;++aR){var n=Y.patterns[aR];am.children(".fpd-pattern-items").append('<div><img src="'+n+'" class="rounded ui image" /></div>').children("div:last").click(function(){X(b(this).children("img").attr("src"),aD)})}aC(am.children(".fpd-pattern-items"))}ax.children(".fpd-center-horizontal, .fpd-center-vertical").click(function(aX){aX.preventDefault();var aY=b(this);d(aD,aY.hasClass("fpd-center-horizontal"),aY.hasClass("fpd-center-vertical"),I?I.getBoundingRect():false)});ax.children(".fpd-move-down, .fpd-move-up").click(function(aY){aY.preventDefault();var a1=i.getObjects(),a2,aZ=null,aX=null;for(var a0=0;a0<a1.length;++a0){if(a1[a0].viewIndex==e){if(aZ==null){aZ=a0}if(aX==null){aX=a0}else{aX++}}if(a1[a0]==aD){a2=a0}}if(a2>aX){a2=aX}if(a2<aZ){a2=aZ}if(b(this).hasClass("fpd-move-down")){if(a2!=aZ){aD.moveTo(a2-1)}}else{if(a2!=aX){aD.moveTo(a2+1)}}j()});ax.children(".fpd-reset").click(function(aY){aY.preventDefault();if(aD){var aZ=aD.originParams;if(aD.type=="i-text"||aD.type=="curvedText"){aD.fontSize=aZ.textSize;aD.setText(aZ.source);aD.setTextAlign(aZ.textAlign);aD.setFontStyle(aZ.fontStyle);aD.setFontWeight(aZ.fontWeight);aA.children(".fpd-text-format-section").find("textarea").val(aZ.source);if(aZ.font){aD.setFontFamily(aZ.font);if(ay){ay.children('option[value="'+aZ.font+'"]').prop("selected","selected").trigger("chosen:updated")}}}if(aZ.autoCenter){m(aD);aZ.x=aD.left;aZ.y=aD.top}else{aD.left=aZ.x;aD.top=aZ.y}aD.scaleX=aZ.scale;aD.scaleY=aZ.scale;aD.angle=aZ.degree;if(aZ.colors&&aZ.currentColor!=aZ.colors[0]){var aX=aD.type=="path-group"?aZ.colors:aZ.colors[0];B(aD,aX)}b(window).resize();av(aD);i.renderAll();aD.params=b.extend({},aZ)}});ax.children(".fpd-trash").click(function(aX){aX.preventDefault();c.removeElement(aD)});aA.children(".fpd-text-format-section").find("textarea").keyup(function(){u(aD,this.value)});if(Y.imageDownloadable){f.find(".fpd-download-image").click(function(aY){var aX=document.createElement("a");if(typeof aX.download!="undefined"){f.find(".fpd-download-anchor").attr("href",c.getProductDataURL()).attr("download","Product.png")[0].click()}else{c.createImage(true,true)}}).show()}if(Y.printable){f.find(".fpd-print").click(function(aX){aX.preventDefault();c.print()}).show()}if(Y.resettable){f.find(".fpd-reset-product").click(function(aX){aX.preventDefault();c.loadProduct(af)}).show()}if(Y._useChosen){ao.find(".fpd-elements-dropdown").chosen({width:"100%"})}if(Y.editorMode){b.post(Y.templatesDirectory+"_editorbox",function(aX){Q.after(b.parseHTML(aX));ap=Q.next(".fpd-editor-box")})}ak.remove();Q.fadeIn(500,function(){Q.trigger("ready")});b(window).resize(function(){q=aq.outerWidth()<Y.dimensions.productStageWidth?aq.outerWidth()/Y.dimensions.productStageWidth:1;q=Number(q.toFixed(2));q=q>1?1:q;i.setDimensions({width:aq.width()*g,height:Y.dimensions.productStageHeight*g*q});K.height(Y.dimensions.productStageHeight*q);var aZ=i.getObjects();for(var aY=0;aY<aZ.length;++aY){var aX=aZ[aY];aX.scaleX=aX.params.scale*q*g;aX.scaleY=aX.params.scale*q*g;aX.left=aX.params.x*q*g;aX.top=aX.params.y*q*g;aX.setCoords()}i.renderAll().calcOffset()}).resize();h.find(".fpd-nav-item").click(function(aX){aX.preventDefault();var aY=b(this);if(!aY.hasClass("active")){aY.parent().children().removeClass("fpd-secondary-bg-color fpd-primary-text-color active").addClass("fpd-secondary-text-color");aY.removeClass("fpd-secondary-text-color").addClass("fpd-secondary-bg-color fpd-primary-text-color active");ao.children("div").hide();ao.children(aY.data("target")).show()}i.calcOffset()}).filter(":visible:first").click();if(b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper picture:first").size()>0){FPDGlobalVariable.bFirst=true;b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper picture:first").click()}else{ag.hide()}};var R=function(n){var aF=n.params;if(typeof aF.colors==="object"||aF.removable||aF.draggable||aF.resizable||aF.rotatable||aF.zChangeable||aF.editable||aF.patternable||aF.uploadZone){n.isEditable=n.evented=true;n.set("selectable",true);if(n.viewIndex==e&&!aF.uploadZone){ao.find(".fpd-elements-dropdown").append('<option value="'+n.id+'">'+n.title+"</option>").trigger("chosen:updated")}}if(Y.editorMode){return false}if(aF.draggable&&!aF.uploadZone){n.lockMovementX=n.lockMovementY=false}if(aF.rotatable&&!aF.uploadZone){n.lockRotation=false}if(aF.resizable&&!aF.uploadZone){n.lockScalingX=n.lockScalingY=false}if((aF.resizable||aF.rotatable||aF.removable)&&!aF.uploadZone){n.hasControls=true}};var H=function(aG){var aI=aG.params;R(aG);if(aI.replace&&aI.replace!=""){var aH=i.getObjects();for(var aF=0;aF<aH.length;++aF){var n=aH[aF];if(n.params!=undefined&&n.clipFor==undefined&&n.params.replace==aI.replace&&n.type==aG.type&&n.visible){aI.z=o(n);aI.x=n.params.x;aI.y=n.params.y;aI.autoCenter=false;c.removeElement(n);break}}}i.add(aG);if(aI.autoCenter){m(aG)}if(aI.currentColor&&aI.pattern==null){B(aG,aI.currentColor)}k(aG);if(aI.z>=0){ab(aG,aI.z)}if(aI.autoSelect&&aG.isEditable){i.setActiveObject(aG);aG.setCoords()}j();if(aI.topped){aG.bringToFront()}i.renderAll().calcOffset();b(window).resize()};var S=function(aI,aH){var aG=aH[0];if(aG){var aF=0;function n(aJ,aL){aF++;if(aF<aH.length){var aK=aH[aF];c.addElement(aK.type,aK.source,aK.title,aK.parameters,ac-1)}else{Q.off("elementAdded",n);Q.trigger("viewCreate",[aH,aI])}}Q.on("elementAdded",n);c.addElement(aG.type,aG.source,aG.title,aG.parameters,ac-1)}else{Q.trigger("viewCreate",[aH,aI])}};var av=function(aG){if(I&&!aG.params.boundingBoxClipping){aG.setCoords();var n=aG.oCoords.tl,aH=false,aF=aG.isOut;var aH=!aG.isContainedWithinRect({x:I.oCoords.tl.x,y:I.oCoords.tl.y},{x:I.oCoords.br.x,y:I.oCoords.br.y});if(aH){aG.borderColor=Y.outOfBoundaryColor;if(Y.tooltips){J.css({right:i.getWidth()-n.x-20,top:n.y-J.outerHeight()-10}).show()}aG.isOut=true}else{aG.borderColor=Y.selectedColor;J.hide();aG.isOut=false}if(aF!=aG.isOut&&aF!=undefined){if(aH){Q.trigger("elementOut")}else{Q.trigger("elementIn")}}}};var B=function(aI,aJ,aF){aF=typeof aF==="undefined"?false:aF;if(aJ.length==4){aJ+=aJ.substr(1,aJ.length)}if(aI.type=="i-text"||aI.type=="curvedText"){aI.setFill(aJ);i.renderAll();if(aF==false){aI.params.pattern=null}M.find("input").spectrum("set",aJ)}else{if(aI.type=="path-group"){for(var aH=0;aH<aJ.length;++aH){aI.paths[aH].setFill(aJ[aH]);M.find("input").eq(aH).spectrum("set",aJ[aH])}}else{var aG=s(aI);if(aG=="png"||aG=="dataurl"){aI.filters.push(new fabric.Image.filters.Tint({color:aJ,opacity:1}));try{aI.applyFilters(i.renderAll.bind(i))}catch(n){alert("Image element could not be colorized. Please be sure that the image is hosted under the same domain and protocol, in which you are using the product designer!")}}else{if(aG=="svg"){aI.setFill(aJ)}}M.find("input").spectrum("set",aJ)}}if(aF==false){aI.params.currentColor=aJ}ah(aI,aJ);V(aI);c.getElementsColor();if(aI.title!="??????"){Q.trigger("priceChange",[0,t,"getElementsColor"])}};var r=function(aF,aG,n){if(aG.length==4){aG+=aG.substr(1,aG.length)}element.setFill(aG)};var ah=function(aF,n){if(aF.colorControlFor){var aH=aF.colorControlFor;for(var aG=0;aG<aH.length;++aG){B(aH[aG],n)}}};var P=function(){return JSON.parse(window.localStorage.getItem(Q.attr("id")+sVerision))};var aj=function(n){if(n==null){return -1}else{if(n==""){return 0}}return 1};var m=function(n){d(n,true,true,c.getBoundingBoxCoords(n));n.params.autoCenter=false};var d=function(aG,aH,n,aF){var aJ,aI;if(aH){if(aF){if(aG.originX=="left"){aJ=aF.left+aF.width*0.5-aG.width*0.5}else{aJ=aF.left+aF.width*0.5}}else{if(aG.originX=="left"){aJ=i.getWidth()*0.5-aG.width*0.5}else{aJ=i.getWidth()*0.5}}aG.left=aJ}if(n){if(aF){if(aG.originX=="left"){aI=aF.top+aF.height*0.5-aG.width*0.5}else{aI=aF.top+aF.height*0.5}}else{if(aG.originX=="left"){aI=i.getHeight()*0.5-aG.height*0.5}else{aI=i.getHeight()*0.5}}aG.top=aI}av(aG);i.renderAll();aG.setCoords();if(aJ!=undefined){aG.params.x=aJ}if(aI!=undefined){aG.params.y=aI}};var an=function(aG,aF){var n=b(".save-list");n.find(".menu").append('<div class="item fpd-clearfix"><img src="'+aG+'" /><i class="fpd-primary-text-color fa fa-times"></i></div>').children("div:last").click(function(aH){FPDGlobalVariable.bProductLoaded=false;var aJ=b(this).data("product");console.log(aJ);var aI=c.getMyProductElementsByTitle("??????",aJ)[0];FPDGlobalVariable.sClothingstyle=aI.parameters.clothingstyle;FPDGlobalVariable.sClothingname=aI.parameters.clothingname;FPDGlobalVariable.sStyleonly=aI.parameters.styleonly;FPDGlobalVariable.sStylereject=aI.parameters.stylereject;c.setColorArea(aI.parameters.diycolors);c.loadProduct(aJ);A=-1}).data("product",aF).children("i").click(function(aI){aI.stopPropagation();var aH=confirm(Y.labels.confirmProductDelete);if(!aH){return false}var aL=n.find(".menu > .item"),aJ=aL.index(b(this).parent(".item").remove()),aK=P();aK.splice(aJ,1);window.localStorage.setItem(Q.attr("id")+sVerision,JSON.stringify(aK))});n.hover(function(){n.find(".menu").slideDown()},function(){n.find(".menu").stop().slideUp(function(){n.find(".menu").css("height","auto")})})};var aC=function(n){if(n.hasClass("ps-container")){n.perfectScrollbar("update").scrollTop(0)}else{n.perfectScrollbar({includePadding:true}).mouseenter(function(){b(this).perfectScrollbar("update")})}};var p=function(aG,aF){var n=aG.name.toLowerCase();var aH=aF.name.toLowerCase();return((n<aH)?-1:((n>aH)?1:0))};var V=function(n){if(ap==undefined){return false}var aF=n.params;ap.find(".fpd-current-element").text(n.title);ap.find(".fpd-position").text("x: "+aF.x+" y: "+aF.y);ap.find(".fpd-dimensions").text("width: "+Math.round(n.getWidth())+" height: "+Math.round(n.getHeight()));ap.find(".fpd-scale").text(Number(aF.scale)%360);ap.find(".fpd-degree").text(aF.degree);ap.find(".fpd-color").text(aF.currentColor)};var U=function(n){WebFont.load({custom:{families:[n]},fontactive:function(aG,aF){i.renderAll()}})};var s=function(n){if(n.type=="i-text"||n.type=="curvedText"){return"text"}var aF=n.source.split(".");if(aF.length==1){if(aF[0].search("data:image/png;")==-1){n.params.currentColor=n.params.colors=false;return false}else{return"dataurl"}}else{if(b.inArray("png",aF)==-1&&b.inArray("svg",aF)==-1){n.params.currentColor=n.params.colors=false;return false}else{if(b.inArray("svg",aF)==-1){return"png"}else{return"svg"}}}};var X=function(n,aF){if(aF.type=="image"){}else{if(aF.type=="i-text"||aF.type=="curvedText"){fabric.util.loadImage(n,function(aG){aF.setFill(new fabric.Pattern({source:aG,repeat:"repeat"}));i.renderAll();aF.params.pattern=n})}}};var ab=function(aH,aJ){var aI=i.getObjects(),n=0;for(var aG=0;aG<aI.length;++aG){var aF=aI[aG];if(aF.visible){if(n==aJ){aH.moveTo(aG);break}n++}}};var W=function(aF){var n=ao.parent().find(".fpd-designs .fpd-items-wrapper");n.append('<picture data-source="'+aF.source+'"><span class="fpd-loading"></span><img src="'+aF.thumbnail+'" title="'+aF.title+'" style="display: none;" /></picture>').children("picture:last").click(function(aG){aG.preventDefault();var aI=b(this),aH=aI.data("parameters");c.addElement("image",aI.data("source"),aI.children("img").attr("title"),aH,e)}).data("parameters",aF.parameters).children("img").load(function(){b(this).fadeIn(500).prev("span").fadeOut(300,function(){b(this).remove();aC(n)})})};var at=function(n,aF,aG){n[aF]=n.params[aF]=aG};var o=function(aF){var aG=i.getObjects(),aH=0;for(var n=0;n<aG.length;++n){if(aG[n].visible){if(aF===aG[n]){return aH;break}aH++}}};var aw=function(aH){var aF=(window.screen.width-700)/2,aG=(window.screen.height-500)/2;var n=window.open(Y.phpDirectory+"/instagram_auth.php","","width=700,height=500,left="+aF+",top="+aG+"");au(n);n.onload=new function(){if(window.location.hash.length==0){n.open("https://instagram.com/oauth/authorize/?client_id="+Y.instagramClientId+"&redirect_uri="+Y.instagramRedirectUri+"&response_type=token","_self")}var aI=setInterval(function(){try{if(n.location.hash.length){clearInterval(aI);window.localStorage.setItem("fpd_instagram_access_token",n.location.hash.slice(14));n.close();if(aH!=undefined&&typeof aH=="function"){aH()}}}catch(aJ){}},100)}};var aa=function(aH){var aF,aI=window.localStorage.getItem("fpd_instagram_access_token");switch(aH){case"feed":aF="https://api.instagram.com/v1/users/self/feed?access_token="+aI;break;case"recent":aF="https://api.instagram.com/v1/users/self/media/recent?access_token="+aI;break;default:aF=aH}var n=ao.children(".fpd-instagram-photos").children(".fpd-items-wrapper").css("visibility","hidden"),aG=ao.children(".fpd-instagram-photos").find(".fpd-insta-load-next");n.children("picture").remove();b.ajax({method:"GET",url:aF,dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpcallback",cache:false,success:function(aJ){if(aJ.data){if(aJ.pagination&&aJ.pagination.next_url){aG.removeClass("disabled").data("href",aJ.pagination.next_url).off("click").on("click",function(){aa(b(this).data("href"));aG.addClass("disabled").off("click")})}else{aG.addClass("disabled").off("click")}b.each(aJ.data,function(aK,aL){if(aL.type=="image"){n.append('<picture><span class="fpd-loading"></span><img src="'+aL.images.thumbnail.url+'" title="'+aL.id+'" data-picture="'+aL.images.standard_resolution.url+'" style="display: none;" /></picture>').children("picture:last").click(function(aM){aM.preventDefault();ag.show();var aN=b(this).children("img");b.post(Y.phpDirectory+"get_image_data_url.php",{url:aN.data("picture")},function(aP){if(aP&&aP.error==undefined){var aO=new Image();aO.src=aP.data_url;aO.onload=function(){Y.customImagesParameters.scale=c.getScalingByDimesions(this.width,this.height,Y.customImagesParameters.resizeToW,Y.customImagesParameters.resizeToH);c.addElement("image",this.src,aN.attr("title"),Y.customImagesParameters,e)}}else{alert(aP.error)}ag.hide()},"json").fail(function(aO){ag.hide();alert(aO.statusText)})}).children("img").load(function(){b(this).fadeIn(500).prev("span").fadeOut(300,function(){b(this).remove();aC(n)})}).error(function(){b(this).parent().remove()})}});n.css("visibility","visible")}else{aw(function(){aa(aH)})}},error:function(aJ,aL,aK){alert("Could not load data from instagram. Please try again!")}})};var k=function(aG){var aH=aG.params;if(aH.boundingBox&&aH.boundingBoxClipping){var n=c.getBoundingBoxCoords(aG);if(n){var aF=new fabric.Rect({left:n.left,top:n.top,width:n.width,height:n.height,originX:"left",originY:"top",fill:"transparent",selectable:false,evented:false,clipFor:aG.id,viewIndex:aG.viewIndex,visible:false,params:{x:n.left,y:n.top,scale:aH.scale}});i.add(aF);aG.setClipTo(function(aI){x(aI,this)})}}};var F=function(aG){var aF=i.getObjects();for(var n=0;n<aF.length;++n){if(aF[n].clipFor==aG){return aF[n];break}}};var x=function(aF,aI){var aG=F(aI.id);var n=(1/aI.scaleX);var aH=(1/aI.scaleY);aF.save();aF.translate(0,0);aF.rotate(fabric.util.degreesToRadians(aI.angle*-1));aF.scale(n,aH);aF.beginPath();aF.rect(aG.left-aI.left-(aI.originX=="left"?aI.width*0.5:0),aG.top-aI.top-(aI.originY=="top"?aI.height*0.5:0),aG.width*g*q,aG.height*g*q);aF.fillStyle="transparent";aF.fill();aF.closePath();aF.restore()};var u=function(n,aF){if(n.params.maxLength!=0&&aF.length>n.params.maxLength){aF=aF.substr(0,n.params.maxLength);n.selectionStart=n.params.maxLength}ao.find(".fpd-elements-dropdown").children('option[value="'+n.id+'"]').text(aF).trigger("chosen:updated");aA.children(".fpd-text-format-section").find("textarea").val(aF);n.params.text=n.title=aF;n.setText(aF);i.renderAll();av(n)};var Z=function(aH){var aG=i.getObjects();for(var aF=0;aF<aG.length;++aF){var n=aG[aF];n.scaleX=n.params.scale*aH*g;n.scaleY=n.params.scale*aH*g;n.left=n.params.x*aH*g;n.top=n.params.y*aH*g;n.setCoords()}return aG};var j=function(){var aG=i.getObjects(),aH=[];for(var aF=0;aF<aG.length;++aF){var n=aG[aF];if(n.visible&&n.params.topped){aH.push(n)}}for(var aF=0;aF<aH.length;++aF){aH[aF].bringToFront()}};var au=function(n){if(n==null||typeof(n)=="undefined"){layer.alert("Please disable your pop-up blocker and try again.")}};var y=function(n){var aF=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return aF.test(n)};this.alterValue=function(n,aF,aG){n[aF]=n.params[aF]=aG;i.renderAll()};this.getProductCustomerElements=function(aI){var aF=[];for(var aH=0;aH<aI.length;aH++){var n=[];for(var aG=0;aG<aI[aH].elements.length;aG++){if(aI[aH].elements[aG].title!="??????"&&aI[aH].elements[aG].title!="Shadow"&&aI[aH].elements[aG].title!="Hightlights"){n.push(aI[aH].elements[aG])}}aF.push({title:aI[aH].title,thumbnail:aI[aH].thumbnail,elements:n,desc:aI[aH].desc,diyeditarea:aI[aH].diyeditarea})}return aF};this.setProductCustomerElements=function(aH,n){aH=JSON.parse(JSON.stringify(aH));for(var aG=0;aG<aH.length;aG++){if(n[aG]!=undefined&&n[aG].elements!=undefined&&n[aG].elements.length>0){for(var aF=0;aF<n[aG].elements.length;aF++){n[aG].elements[aF].parameters.boundingBox=aH[aG].diyeditarea}if(aH[aG].elements instanceof Array){Array.prototype.push.apply(aH[aG].elements,n[aG].elements)}else{aH[aG].elements=n[aG].elements}}}return aH};this.getElementsColor=function(aH){var n=FPDGlobalVariable.aProduct;if(!n){return false}FPDGlobalVariable.aCustomerElementsColor=[[],[]];FPDGlobalVariable.aCustomerImageColor=[[],[]];FPDGlobalVariable.aCustomerDesignElements=[[],[]];for(var aG=0;aG<n.length;aG++){for(var aF=0;aF<n[aG].elements.length;aF++){if(n[aG].elements[aF].title!="??????"&&n[aG].elements[aF].title!="Shadow"&&n[aG].elements[aF].title!="Hightlights"){if(!!n[aG].elements[aF].parameters.currentColor){FPDGlobalVariable.aCustomerElementsColor[aG].push(n[aG].elements[aF].parameters.currentColor)}else{if(!!n[aG].elements[aF].parameters.imgcolors&&n[aG].elements[aF].parameters.imgcolors instanceof Array&&n[aG].elements[aF].parameters.imgcolors.length>0){Array.prototype.push.apply(FPDGlobalVariable.aCustomerImageColor[aG],n[aG].elements[aF].parameters.imgcolors)}else{if(n[aG].elements[aF].parameters.colors instanceof Array&&n[aG].elements[aF].parameters.colors.length>0){FPDGlobalVariable.aCustomerElementsColor[aG].push(n[aG].elements[aF].parameters.colors[0])}else{FPDGlobalVariable.aCustomerElementsColor[aG].push("#000000")}}}FPDGlobalVariable.aCustomerDesignElements[aG].push(n[aG].elements[aF])}}}};this.reloadProduct=function(n){FPDGlobalVariable.bProductLoaded=false;c.loadProduct(n);A=-1};this.selectElement=function(n){if(n.params.autoSelect===true){i.setActiveObject(n)}};this.getBoundingBoxCoords=function(aI){var aK=aI.params;if(aK.boundingBox||aK.uploadZone){var aG;if(typeof aK.boundingBox=="object"){return{left:aK.boundingBox.x,top:aK.boundingBox.y,width:aK.boundingBox.width,height:aK.boundingBox.height}}else{var aJ=i.getObjects();for(var aH=0;aH<aJ.length;++aH){var aF=aJ[aH];if(aF.viewIndex==e){if(aK.boundingBox==aF.title){var n=aF.getBoundingRect();return{left:n.left/q/g,top:n.top/q/g,width:n.width/q/g,height:n.height/q/g};break}}}}}return false};this.getFabricJSON=function(){c.deselectElement();var n=i.toJSON(["viewIndex"]);n.width=i.width;n.height=i.height;return n};this.getPrice=function(){return t};this.getProduct=function(aH){aH=typeof aH!=="undefined"?aH:false;c.deselectElement();c.zoomReset();var aL=i.getObjects();for(var aJ=0;aJ<aL.length;++aJ){var aG=aL[aJ];if(aG.isOut){alert('"'+aG.title+'":'+Y.labels.outOfContainmentAlert);return false}}var aK=[];for(var aJ=0;aJ<af.length;++aJ){var aF=af[aJ];aK.push({title:aF.title,thumbnail:aF.thumbnail,elements:[],desc:aF.desc,diyeditarea:aF.diyeditarea})}for(var aJ=0;aJ<aL.length;++aJ){var aG=aL[aJ];var aI={title:aG.title,source:aG.source,parameters:aG.params,type:(aG.type=="i-text"||aG.type=="curvedText")?"text":"image"};if(aG.clipFor==undefined){if(aH){if(aG.isEditable){aK[aG.viewIndex].elements.push(aI)}}else{aK[aG.viewIndex].elements.push(aI)}}}if(aK.length>1){var aJ,n=1;for(aJ=0;aJ<aK[0].elements.length;aJ++){n++}for(aJ=0;aJ<aK[1].elements.length;aJ++){if(aK[1].elements[aJ].parameters.z>-1){aK[1].elements[aJ].parameters.z+=n}}}return aK};this.getProductNoVerify=function(aH){aH=typeof aH!=="undefined"?aH:false;c.deselectElement();c.zoomReset();var aL=i.getObjects();var aK=[];for(var aJ=0;aJ<af.length;++aJ){var aF=af[aJ];aK.push({title:aF.title,thumbnail:aF.thumbnail,elements:[],desc:aF.desc,diyeditarea:aF.diyeditarea})}for(var aJ=0;aJ<aL.length;++aJ){var aG=aL[aJ];var aI={title:aG.title,source:aG.source,parameters:aG.params,type:(aG.type=="i-text"||aG.type=="curvedText")?"text":"image"};if(aG.clipFor==undefined){if(aH){if(aG.isEditable){aK[aG.viewIndex].elements.push(aI)}}else{aK[aG.viewIndex].elements.push(aI)}}}if(aK.length>1){var aJ,n=1;for(aJ=0;aJ<aK[0].elements.length;aJ++){n++}for(aJ=0;aJ<aK[1].elements.length;aJ++){if(aK[1].elements[aJ].parameters.z>-1){aK[1].elements[aJ].parameters.z+=n}}}return aK};this.changeColor=function(aF,aG,n){B(aF,aG,n)};this.getProductIndex=function(){return A};this.getResponsiveScale=function(){return q};this.getViewsDataURL=function(aI,n,aJ){aI=typeof aI!=="undefined"?aI:"png";n=typeof n!=="undefined"?n:"transparent";aJ=typeof aJ!=="undefined"?aJ:1;c.deselectElement();c.zoomReset();var aF=[],aH=i.getWidth(),aG=i.getHeight();i.setDimensions({width:Y.dimensions.productStageWidth,height:Y.dimensions.productStageHeight}).setBackgroundColor(n,function(){var aO=Z(1);for(var aN=0;aN<ac;++aN){for(var aM=0;aM<aO.length;++aM){var aL=aO[aM];aL.visible=aL.viewIndex==aN}try{aF.push(i.toDataURL({format:aI,multiplier:aJ}))}catch(aK){alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!")}}for(var aN=0;aN<aO.length;++aN){var aL=aO[aN];aL.visible=aL.viewIndex==e}Z(q);i.setDimensions({width:aH,height:aG}).setBackgroundColor("transparent").renderAll()});return aF};this.getViewsSVG=function(){c.deselectElement();c.zoomReset();var aG=[],aF=i.getWidth(),aM=i.getHeight();i.setDimensions({width:Y.dimensions.productStageWidth,height:Y.dimensions.productStageHeight});var aL=Z(1);for(var aJ=0;aJ<ac;++aJ){for(var aI=0;aI<aL.length;++aI){var aH=aL[aI];aH.visible=aH.viewIndex==aJ;if(aH.type=="path-group"){aH.left=(aH.params.x*1)-aH.getWidth()*0.5;aH.top=(aH.params.y*1)-aH.getHeight()*0.5;aH.setCoords()}}var aK=i.toSVG(),n=b(aK);n.children("rect").remove();n.children("g").children('[style*="visibility: hidden"]').parent("g").remove();aK=b("<div>").append(n.clone()).html().replace(/(?:\r\n|\r|\n)/g,"");aG.push(aK)}for(var aJ=0;aJ<aL.length;++aJ){var aH=aL[aJ];aH.visible=aH.viewIndex==e;if(aH.type=="path-group"){aH.left=(aH.params.x*q);aH.top=(aH.params.y*q);aH.setCoords()}}Z(q);i.setDimensions({width:aF,height:aM}).renderAll();return aG};this.getProductDataURL=function(aI,n,aJ){aI=typeof aI!=="undefined"?aI:"png";n=typeof n!=="undefined"?n:"transparent";aJ=typeof aJ!=="undefined"?aJ:1;c.deselectElement();c.zoomReset();c.selectView(0);var aH,aG=i.getWidth(),aF=i.getHeight();i.setBackgroundColor(n,function(){i.setDimensions({width:Y.dimensions.productStageWidth,height:Y.dimensions.productStageHeight*ac});var aN=Z(1);for(var aM=0;aM<aN.length;++aM){var aL=aN[aM];aL.visible=true;aL.top=aL.top+(aL.viewIndex*Y.dimensions.productStageHeight)}try{aH=i.toDataURL({format:aI,multiplier:aJ})}catch(aK){alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!")}for(var aM=0;aM<aN.length;++aM){var aL=aN[aM];aL.visible=aL.viewIndex==0;aL.top=aL.top-(aL.viewIndex*Y.dimensions.productStageHeight)}Z(q);i.setDimensions({width:aG,height:aF}).setBackgroundColor("transparent").renderAll()});return aH};this.getProductsLength=function(){return b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper picture").size()};this.getView=function(){return af[e]};this.getViewDataURL=function(aH,n,aJ){aH=typeof aH!=="undefined"?aH:"png";n=typeof n!=="undefined"?n:"transparent";aJ=typeof aJ!=="undefined"?aJ:1;c.deselectElement();c.zoomReset();var aI="",aG=i.getWidth(),aF=i.getHeight();i.setDimensions({width:Y.dimensions.productStageWidth,height:Y.dimensions.productStageHeight}).setBackgroundColor(n,function(){Z(1);try{aI=i.toDataURL({format:aH,multiplier:aJ})}catch(aK){alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!");return false}Z(q);i.setDimensions({width:aG,height:aF}).setBackgroundColor("transparent").renderAll()});if(aI.length){return aI}else{return false}};this.getViewSVG=function(){c.deselectElement();c.zoomReset();var aJ=i.getWidth(),aI=i.getHeight();i.setDimensions({width:Y.dimensions.productStageWidth,height:Y.dimensions.productStageHeight});Z(1);for(var aH=0;aH<i.getObjects().length;++aH){var aF=i.getObjects()[aH];if(aF.type=="path-group"){aF.left=(aF.params.x*1)-aF.getWidth()*0.5;aF.top=(aF.params.y*1)-aF.getHeight()*0.5;aF.setCoords()}}var n=i.toSVG(),aG=b(n);aG.children("rect").remove();aG.children("g").children('[style*="visibility: hidden"]').parent("g").remove();n=b("<div>").append(aG.clone()).html().replace(/(?:\r\n|\r|\n)/g,"");for(var aH=0;aH<i.getObjects().length;++aH){var aF=i.getObjects()[aH];if(aF.type=="path-group"){aF.left=(aF.params.x*q);aF.top=(aF.params.y*q);aF.setCoords()}}Z(q);i.setDimensions({width:aJ,height:aI}).renderAll();return n};this.getViewIndex=function(){return e};this.getStage=function(){return i};this.getScalingByDimesions=function(aG,aI,n,aH){var aF=1;if(aG>aI){if(aG>n){aF=n/aG}if(aF*aI>aH){aF=aH/aI}}else{if(aI>aH){aF=aH/aI}if(aF*aG>n){aF=n/aG}}return aF};this.setColorArea=function(n){b(".clothing-color-area").remove();if(n.indexOf(",")>-1){var aF="";n.split(",").forEach(function(aG){aF+='<span class="clothing-color-item" style="background-color:'+aG+'" data-color="'+aG+'"></span>'});aF='<div class="clothing-color-area">'+aF+"</div>";b(".fpd-product-picture-container").append(aF)}};this.addProduct=function(n){var aF=b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper");var aG=aF.append('<picture data-category="'+n[0].category+'" title="'+n[0].title+'"><span class="fpd-loading"></span><img src="'+n[0].thumbnail+'" title="'+n[0].title+'" style="display:none;" /><span class="product-desc">'+(n[0].desc?n[0].desc:"")+"</span></picture>").find("picture:last").click(function(aI){var aL=b(this),aK=aF.find("picture").index(aL);var aH=aL.data("views")[0].elements[0].parameters;c.setColorArea(aH.diycolors);if(aH.clothingstyle=="pl"&&aH.clothingname.indexOf("(??????")>-1){Y.defaultText="??????";Y.textParameters.textSize="28"}else{Y.defaultText="??????????????????????????????";Y.textParameters.textSize="18"}FPDGlobalVariable.sClothingstyle=aH.clothingstyle;FPDGlobalVariable.sClothingname=aH.clothingname;FPDGlobalVariable.sStyleonly=aH.styleonly;FPDGlobalVariable.sStylereject=aH.stylereject;Y.elementParameters.boundingBox=aL.data("views")[0].diyeditarea;FPDGlobalVariable.bProductLoaded=false;if(FPDGlobalVariable.bFirst==false){FPDGlobalVariable.bSelect=true;var aJ=c.getProductNoVerify(false);FPDGlobalVariable.aCustomerElements=c.getProductCustomerElements(aJ)}c.selectProduct(aK);aI.preventDefault()}).data("views",n).children("img").load(function(){b(this).fadeIn(500).prev("span").fadeOut(300,function(){b(this).nextAll(".product-desc").fadeIn(300).end().remove()})});if(Y.tooltips){aG.parent().tooltipster({offsetX:4,theme:".fpd-tooltip-theme",touchDevices:false,position:"left"})}if(aF.find("picture").length==2){h.find('[data-target=".fpd-products"]').css("display","inline-block")}};this.loadProduct=function(aF){if(ag.is(":visible")){return false}c.clear();ag.stop().show();af=aF;T=af[0].title;var n='<div class="fpd-views-selection fpd-clearfix fpd-'+Y.viewSelectionPosition+" "+(Y.viewSelectionFloated?"fpd-float-items":"")+'"></div>';if(Y.viewSelectionPosition=="outside"){K.after(n)}else{K.append(n)}Q.on("viewCreate",aG);function aG(){if(ac<af.length){c.addView(af[ac])}else{Q.off("viewCreate",aG);Q.trigger("productCreate",[T]);ag.stop().hide();c.selectView(0);var aI=i.getObjects();for(var aH=0;aH<aI.length;++aH){var aJ=aI[aH];if(aJ.viewIndex==e&&aJ.params&&aJ.params.autoSelect){i.setActiveObject(aJ);aJ.setCoords()}}}}c.addView(af[0])};this.selectProduct=function(aF){if(aF==A){return false}A=aF;if(aF<0){A=0}else{if(aF>c.getProductsLength()-1){A=c.getProductsLength()-1}}var n=b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper picture").eq(A).data("views");if(FPDGlobalVariable.bFirst===false&&FPDGlobalVariable.bSelect===true&&FPDGlobalVariable.aCustomerElements!=null){n=c.setProductCustomerElements(n,FPDGlobalVariable.aCustomerElements)}c.loadProduct(n)};this.selectView=function(aG){e=aG;if(aG<0){e=0}else{if(aG>E.children().size()-1){e=E.children().size()-1}}var n=E.children("div").removeClass("fpd-view-active").eq(aG).addClass("fpd-view-active").data("diyviews");Y.elementParameters.boundingBox=n.diyeditarea;c.deselectElement();ao.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove();var aI=i.getObjects();for(var aH=0;aH<aI.length;++aH){var aF=aI[aH];aF.visible=aF.viewIndex==e;if(aF.viewIndex==e&&aF.isEditable&&!aF.params.uploadZone){ao.find(".fpd-elements-dropdown").append('<option value="'+aF.id+'">'+aF.title+"</option>")}}ao.find(".fpd-elements-dropdown").trigger("chosen:updated");i.renderAll()};this.removeProduct=function(n){if(n<0){n=0}else{if(n>c.getProductsLength()-1){n=c.getProductsLength()-1}}b(".fpd-product-picture-container").find(".fpd-products .fpd-items-wrapper picture").eq(n).remove();if(n==A){c.clear();A=-1}};this.addView=function(aG){ac++;E=aq.find(".fpd-views-selection");var aF=Y.viewSelectionPosition=="outside"?"stacked":"";var n=E.append('<div class="fpd-secondary-bg-color fpd-border-color ui '+aF+' segment">'+(ac>1?"??????":"??????")+"</div>").children("div:last").click(function(aI){aI.preventDefault();c.selectView(E.children("div").index(b(this)))}).data("diyviews",aG);var aH=n.children("img");if(Y.tooltips){aH.tooltipster({offsetY:0,theme:".fpd-tooltip-theme",touchDevices:false,position:"left"})}S(aG.title,aG.elements);ac>1?E.show():E.hide()};this.addElement=function(aL,n,aM,aJ,aH){aH=typeof aH!=="undefined"?aH:e;c.deselectElement();if(typeof aJ!="object"){alert("The element "+aM+" does not have a valid JSON object as parameters! Please check the syntax, maybe you set quotes wrong.");return false}aJ=b.extend({},Y.elementParameters,aJ);if(aL=="text"||aL=="i-text"||aL=="curvedText"){aJ=b.extend({},Y.textParameters,aJ)}if(aJ.topped){aJ.zChangeable=false}aJ.source=n;var aR=false,aS=null;if(aJ.colors&&typeof aJ.colors=="string"){if(aJ.colors.indexOf("#")==0){var aF=aJ.colors.replace(/\s+/g,"").split(",");aJ.colors=aF}else{if(ac>1){var aQ=i.getObjects();for(var aK=0;aK<aQ.length;++aK){var aI=aQ[aK];if(aI.viewIndex==0){if(aJ.colors==aI.title&&aS==null){aS=aI;aR=true}}}}}}var aN={source:n,title:aM,top:aJ.y,left:aJ.x,originX:aJ.originX,originY:aJ.originY,scaleX:aJ.scale,scaleY:aJ.scale,angle:aJ.degree,opacity:aJ.opacity,id:String(new Date().getTime()),visible:aH==e,viewIndex:aH,lockUniScaling:true,lineHeight:1.2};if(!!aJ.minScaleLimit){aN.minScaleLimit=aJ.minScaleLimit}if(!!aJ.maxScaleLimit){aN.maxScaleLimit=aJ.maxScaleLimit}if(Y.editorMode){aJ.removable=aJ.resizable=aJ.rotatable=aJ.zChangeable=true}else{b.extend(aN,{selectable:false,lockRotation:true,lockScalingX:true,lockScalingY:true,lockMovementX:true,lockMovementY:true,hasControls:false,evented:false})}if(aL=="image"||aL=="path"){var aP=function(aV,aW){var aT=aV.width*aW.scale,aU=aV.height*aW.scale;b.extend(aN,{params:aW,originParams:b.extend({},aW),crossOrigin:"anonymous"});aV.set(aN);if(aR){if(aS.colorControlFor){aS.colorControlFor.push(aV)}else{aS.colorControlFor=[];aS.colorControlFor.push(aV)}}H(aV);Q.trigger("elementAdded",[aV])};var aO=n.split(".");if(b.inArray("svg",aO)!=-1){fabric.loadSVGFromURL(n,function(aX,aU){var aW=fabric.util.groupSVGElements(aX,aU);aJ.colors=[];for(var aV=0;aV<aX.length;++aV){var aT=tinycolor(aX[aV].fill);aJ.colors.push(aT.toHexString())}aP(aW,aJ)})}else{new fabric.Image.fromURL(n,function(aT){aP(aT,aJ)})}}else{if(aL=="text"||aL=="i-text"||aL=="curvedText"){aJ.text=aJ.text?aJ.text:aJ.source;aJ.font=aJ.font?aJ.font:Y.fonts[0];if(aJ.font==undefined){aJ.font="Arial"}b.extend(aN,{fontSize:aJ.textSize,fontFamily:aJ.font,fontStyle:aJ.fontStyle,fontWeight:aJ.fontWeight,textAlign:aJ.textAlign,textBackgroundColor:aJ.textBackgroundColor,lineHeight:aJ.lineHeight,textDecoration:aJ.textDecoration,fill:aJ.colors[0]?aJ.colors[0]:"#000000",editable:aJ.editable,spacing:aJ.curveSpacing,radius:aJ.curveRadius,reverse:aJ.curveReverse,params:aJ,originParams:b.extend({},aJ)});if(aJ.curved){var aG=new fabric.CurvedText(aJ.text.replace(/\\n/g,"\n"),aN)}else{var aG=new fabric.IText(aJ.text.replace(/\\n/g,"\n"),aN)}H(aG);if(aJ.pattern){X(aJ.pattern,aG)}U(aJ.font);Q.trigger("elementAdded",[aG])}else{alert("Sorry. This type of element is not allowed!");return false}}if(aJ.price&&!aJ.uploadZone){t+=aJ.price;Q.trigger("priceChange",[aJ.price,t,"addElement"])}};this.addDesign=function(aG,aH,aF,n,aI){aI=typeof aI=="undefined"?aG:aI;if(v===null||v===false){W({source:aG,title:aH,parameters:aF,thumbnail:aI})}else{n=typeof n=="undefined"?v.val():n;if(az[n]==undefined){az[n]=new Array();v.append('<option value="'+n+'">'+n+"</option>").trigger("chosen:updated")}az[n].push({source:aG,title:aH,parameters:aF,thumbnail:aI});if(v.val()==n){W({source:aG,title:aH,parameters:aF,thumbnail:aI})}}};this.addCustomImage=function(n,aJ,aK,aM,aH,aI,aF){c.zoomReset();var aL=f.find(".fpd-input-image"),aG=new Image;aG.src=n;aG.onload=function(){var aQ=this.height,aO=this.width,aN=1;var aP=b.extend({},Y.customImagesParameters);aP.scale=c.getScalingByDimesions(aO,aQ,Y.customImagesParameters.resizeToW,Y.customImagesParameters.resizeToH);aP.imgcolors=aK;aP.imgid=aM;if(aH){aP.imgWidth=aH}if(aI){aP.imgHeight=aI}if(aI){aP.photo=aF}c.addElement("image",n,aJ,aP)};aG.onerror=function(aN){alert("?????????????????????")}};this.print=function(){var aI=c.getViewsDataURL(),n=new Array(),aG=0;for(var aF=0;aF<aI.length;++aF){var aH=new Image();aH.src=aI[aF];aH.onload=function(){n.push(this);aG++;if(aG==aI.length){var aJ=window.open("","","width="+n[0].width+",height="+(n[0].height*aI.length)+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");au(aJ);aJ.document.title="Print Image";for(var aK=0;aK<n.length;++aK){b(aJ.document.body).append('<img src="'+n[aK].src+'" />')}setTimeout(function(){aJ.print()},1000)}}}return false};this.createImage=function(n,aF){if(typeof(n)==="undefined"){n=true}if(typeof(aF)==="undefined"){aF=false}var aH=c.getProductDataURL();var aG=new Image();aG.src=aH;aG.onload=function(){if(n){var aI=window.open("","","width="+this.width+",height="+this.height+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");au(aI);aI.document.title="Product Image";b(aI.document.body).append('<img src="'+this.src+'" />');if(aF){window.location.href=aI.document.getElementsByTagName("img")[0].src.replace("image/png","image/octet-stream")}}Q.trigger("imageCreate",[aH])};return aG};this.clear=function(){c.deselectElement();c.zoomReset();if(E){E.remove()}ao.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove();ao.find(".fpd-elements-dropdown").trigger("chosen:updated");i.clear();ac=e=t=0;af=aD=null;Q.trigger("stageClear")};this.deselectElement=function(n){n=typeof n=="undefined"?true:n;M.removeClass("fpd-colorpicker-group").empty();if(Y.layout=="semantic"){M.addClass("ui button")}J.hide();if(I){I.remove();I=null}if(n){i.discardActiveObject()}ao.find(".fpd-elements-dropdown").children("option:first").prop("selected",true).trigger("chosen:updated");aA.css("visibility","hidden").children(".fpd-filling-wrapper, .fpd-text-format-section, .fpd-curved-text-wrapper").hide().parent().find(".fpd-color-picker, .fpd-fonts-dropdown-wrapper, .fpd-text-styles").hide();aA.children(".fpd-text-format-section").find("textarea").val("");am.hide();aB.hide().find(".fpd-curve-toggle").hide();aD=null;if(ap){ap.find("i").text("")}i.renderAll().calcOffset()};this.removeElement=function(n){if(typeof n==="string"){n=c.getElementByTitle(n)}if(n.params.price!=0&&!n.params.uploadZone){t-=n.params.price;Q.trigger("priceChange",[n.params.price,t,"removeElement"])}ao.find(".fpd-elements-dropdown").children('option[value="'+n.id+'"]').remove().trigger("chosen:updated");i.remove(n);Q.trigger("elementRemove",[n]);c.deselectElement()};this.getElementByTitle=function(aG){var aF=i.getObjects();for(var n=0;n<aF.length;++n){if(aF[n].title==aG){return aF[n];break}}};this.getElementsByTitle=function(aH){var aG=i.getObjects();var n=[];for(var aF=0;aF<aG.length;++aF){if(aG[aF].title==aH){n.push(aG[aF])}}return n};this.getMyProductElementsByTitle=function(aI,aH){var n=[];for(var aG=0;aG<aH.length;aG++){for(var aF=0;aF<aH[aG].elements.length;aF++){if(aH[aG].elements[aF].title==aI){n.push(aH[aG].elements[aF])}}}return n};this.zoomIn=function(){g=g*Y.zoomFactor;if(g>Y.zoomRange[1]){return false}var aG=i.getObjects();for(var aF=0;aF<aG.length;++aF){var n=aG[aF];n.scaleX=n.scaleX*Y.zoomFactor;n.scaleY=n.scaleY*Y.zoomFactor;n.left=n.left*Y.zoomFactor;n.top=n.top*Y.zoomFactor;n.setCoords()}i.setDimensions({width:i.getWidth()*Y.zoomFactor,height:i.getHeight()*Y.zoomFactor}).calcOffset().renderAll();if(g>1){K.perfectScrollbar()}};this.zoomOut=function(){g=g/Y.zoomFactor;if(g<Y.zoomRange[0]){return false}var aG=i.getObjects();for(var aF=0;aF<aG.length;++aF){var n=aG[aF];n.scaleX=n.scaleX*(1/Y.zoomFactor);n.scaleY=n.scaleY*(1/Y.zoomFactor);n.left=n.left*(1/Y.zoomFactor);n.top=n.top*(1/Y.zoomFactor);n.setCoords()}i.setDimensions({width:i.getWidth()*(1/Y.zoomFactor),height:i.getHeight()*(1/Y.zoomFactor)}).calcOffset().renderAll();if(g<=1){K.perfectScrollbar("destroy")}};this.zoomReset=function(){g=1;var aG=i.getObjects();for(var aF=0;aF<aG.length;++aF){var n=aG[aF];n.scaleX=aG[aF].params.scale*q;n.scaleY=aG[aF].params.scale*q;n.left=aG[aF].params.x*q;n.top=aG[aF].params.y*q;n.setCoords()}i.setDimensions({width:aq.width(),height:Y.dimensions.productStageHeight*q}).calcOffset().renderAll();if(g<=1){K.perfectScrollbar("destroy")}};this.setStageDimensions=function(aF,n){Y.dimensions.productStageWidth=aF;Y.dimensions.productStageHeight=n;aq.width(aF);K.height(n*q);i.setDimensions({width:aq.width(),height:Y.dimensions.productStageHeight*q}).calcOffset().renderAll()};fabric.Object.prototype._drawControl=function(aK,n,aF,aJ,aI){var aG=this.cornerSize;if(this.isControlVisible(aK)){this.transparentCorners||n.clearRect(aJ,aI,aG,aG);if(aK=="tr"||aK=="br"||aK=="mtr"){var aH;switch(aK){case"tr":aH=this.params.removable?w:false;break;case"br":aH=this.params.resizable?ar:false;break;case"mtr":aH=this.params.rotatable?O:false;break}if(aH!==false){n.drawImage(aH,aJ,aI,aG,aG);n[aF](aJ,aI,aG,aG)}}}};fabric.Object.prototype.findTargetCorner=function(aJ){if(!this.hasControls||!this.active){return false}var aI=aJ.x,aG=aJ.y,aF,n;for(var aH in this.oCoords){if(!this.isControlVisible(aH)){continue}if(aH==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(aH==="mt"||aH==="mr"||aH==="mb"||aH==="ml")){continue}n=this._getImageLines(this.oCoords[aH].corner);aF=this._findCrossPoints({x:aI,y:aG},n);if(aF!==0&&aF%2===1){this.__corner=aH;return aH}}return false};fabric.IText.prototype.initHiddenTextarea=function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -100px; opacity: 0; width: 0; height: 0; z-index: -99999;";this.canvas.wrapperEl.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}}};jQuery.fn.fancyProductDesigner=function(c){return this.each(function(){var e=b(this);if(e.data("fancy-product-designer")){return}var d=new a(this,c);e.data("fancy-product-designer",d)})};b.fn.fancyProductDesigner.defaults={_useChosen:true,elementParameters:{x:0,y:0,z:-1,colors:false,removable:false,draggable:false,rotatable:false,resizable:false,zChangeable:false,scale:1,degree:0,price:0,boundingBox:false,autoCenter:false,opacity:1,originX:"center",originY:"center",replace:"",boundingBoxClipping:false,autoSelect:false,topped:false,uploadZone:false},textParameters:{font:false,fontWeight:"",fontStyle:"",textSize:18,patternable:false,editable:true,lineHeight:1,textAlign:"left",textBackgroundColor:"",textDecoration:"",maxLength:0,curved:false,curvable:false,curveSpacing:10,curveRadius:80,curveReverse:false},customImagesParameters:{minW:100,minH:100,maxW:1500,maxH:1500,resizeToW:260,resizeToH:260,imgid:"",imgname:"",imgWidth:0,imgHeight:0,photo:0},customTextParameters:{},uploadDesigns:true,customTexts:true,imageDownloadable:true,saveAsPdf:true,printable:true,allowProductSaving:true,resettable:true,tooltips:true,editorMode:false,menubarPosition:"outside",viewSelectionPosition:"tr",viewSelectionFloated:false,fonts:["Arial","Helvetica","Times New Roman","Verdana","Geneva","simsun"],templatesDirectory:GlobalConfigUrl.indexUrl+"/",phpDirectory:"php/",patterns:[],layout:"icon-sb-left",facebookAppId:"",instagramClientId:"",instagramRedirectUri:"",zoomFactor:1.2,zoomRange:[0.2,2],defaultText:"??????????????????????????????",hexNames:{},selectedColor:"#d5d5d5",boundingBoxColor:"#005ede",boundingBoxBorderWidth:2,outOfBoundaryColor:"#990000",paddingControl:7,dimensions:{sidebarNavSize:50,sidebarContentWidth:320,sidebarSize:650,productStageWidth:750,productStageHeight:750,productStageContainerWidth:720},labels:{outOfContainmentAlert:"?????????????????????????????????",confirmProductDelete:"???????????????????????????????????????",colorpicker:{cancel:"??????",change:"????????????"},uploadedDesignSizeAlert:"???????????????????????????????????????????????????????????????",initText:"?????????????????????",myUploadedImgCat:"Your uploaded images"},sidebarLabels:{productsMenu:"Products",designsMenu:"Designs",editElementsMenu:"Edit Elements",fbPhotosMenu:"Add Photos From Facebook",instaPhotosMenu:"Add Photos From Instagram",editElementsHeadline:"Edit Elements",editElementsDropdownNone:"None",sectionFilling:"Filling",sectionFontsStyles:"Font & Style",sectionCurvedText:"Curved Text",sectionHelpers:"Helpers",textAlignLeft:"Align Left",textAlignCenter:"Align Center",textAlignRight:"Align Right",textBold:"Bold",textItalic:"Italic",curvedTextInfo:"You can only change the text when you switch to normal text.",curvedTextSpacing:"Spacing",curvedTextRadius:"Radius",curvedTextReverse:"Reverse",curvedTextToggle:"Switch between curved and normal Text",centerH:"Center Horizontal",centerV:"Center Vertical",moveDown:"Bring It Down",moveUp:"Bring It Up",reset:"Reset",trash:"Trash",fbPhotosHeadline:"Facebook Photos",fbSelectAlbum:"Select an album",instaPhotosHeadline:"Instagram Photos",instaFeedButton:"My Feed",instaRecentImagesButton:"My Recent Images",instaLoadNext:"Load next stack"},productStageLabels:{addImageTooltip:"Add your own Image",addTextTooltip:"Add your own Text",zoomInTooltip:"Zoom In",zoomOutTooltip:"Zoom Out",zoomResetTooltip:"Zoom Reset",downloadImageTooltip:"Download Product Image",printTooltip:"Print",pdfTooltip:"Save As PDF",saveProductTooltip:"Save product",savedProductsTooltip:"Your saved products",resetTooltip:"Reset Product"}}})(jQuery);