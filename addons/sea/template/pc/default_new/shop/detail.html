<!--头部调用-->
{template 'common/search_header'}
<title>{$goods['title']}</title>
<style type="text/css">
.on{ color: #fc5454; border: 1px solid #fc5454;}
.list-bor{border-bottom:1px #DCDCDC dotted;min-height: 40px;overflow: hidden;position:relative;padding-left:75px}
.list-bor .spec { width:65px;padding:0;float:left;position: absolute;;left: 10px;top: 0;line-height: 40px;color: #565656}
.list-bor .spec_items {width:100%;padding:5px 0 5px 0;height:auto;border-bottom:none;float:left}
.list-bor .option { float:left; padding:0 5px; background:#fff; border:1px solid #c3c3c3;min-width: 10px;text-align: center;
 border-radius:2px; margin-right:4px;margin-bottom:4px; font-size:12px; color: #999;height: 30px;line-height: 28px;}
 .list-bor .on {background:#fc5454; border:1px solid #fc5454; color:#fff}
.other{width: 100%;line-height: 34px;font-size: 14px;color: #999;margin-top: 10px}
.other .left{float: left;text-align: right}
.other1{border-top: 1px dashed #f3f3f3;width: 100%;font-size: 14px;color: #999;height: auto;overflow: hidden;	line-height: 22px;padding: 2px 0;}
.other1 .right{float: right;text-align: left;margin-left: -80px;width: 100%;}
.other1 .right .inner{width: 100%;margin-bottom: 20px;overflow: hidden;margin-left: 80px;}
.good_speci{height: 44px;
width: 100%;
overflow: hidden;
background: #fff;
padding: 0px 3%;
margin-top: 14px;
border-bottom: 1px solid #e2e2e2;
line-height: 44px;
color: #666;
font-size: 14px;}
.store{
	height:80px;
background: #fff;
padding: 5px;
border-bottom: 1px solid #eaeaea;}
.store .info .ico{float: left;
height: 50px;
width: 30px;
line-height: 30px;
font-size: 16px;
text-align: center;
color: #666;}
.store .info .info1 {
height: 54px;
width: 100%;
float: left;
margin-left: -30px;
margin-right: -60px;
}
.store .info .ico2 {
height: 50px;
width: 30px;
padding-top: 15px;
float: right;
font-size: 24px;
text-align: center;
color: #ccc;
}
.store .info .ico3 {
height: 50px;
width: 30px;
padding-top: 15px;
float: right;
font-size: 24px;
text-align: center;
color: #ccc;
}
.store .info .info1 .inner {
margin-left: 30px;
margin-right: 60px;
overflow: hidden;
}
</style>
<body class="campaign">
<!--<div id='container'style="width:1200px;margin:120px auto 0"></div>-->
<section id="mainbody" class="container clearfix"></section>
<div id='cover'><img src='../addons/sea/static/images/guide.png' style='width:100%;' /></div>

<script id='goods_info'  type='text/html'>
    <input type="hidden" id="followed" value="<%followed%>" />
    <input type="hidden" id="needfollow" value="<%goods.needfollow%>" />
    <input type="hidden" id="followurl" value="<%followurl%>" />
    <input type='hidden' id='followtip' value='<%followtip%>'/>
    
<div class="clearfix mb15" style = "width:1200px;">
  <div class="left-area">
            <div class="show-area norightkey clearfix">
                <div class="show-img">
                	<ul class="cf">
                     <%each pics as p %>
                      <li><img src='<%p%>'/></li>
                     <%/each%>
                    </ul>
                </div>
                <div id="divsmallpic" class="thumb-area mt10 clearfix">
                    <div class="btn lbtn disable" style="padding:0px "><i class="icon" id="prev"></i></div>
                    <div class="sthumb">
                      <div class="rthumb">
                        <%each pics as p %>
                        <div class="btn-thumb imgList">
                            <span class="bd" style="z-index:-1"></span>
                                <img data-src="<%p%>" src="<%p%>" data-imgsrc="" style="height:78px;width:78px "/>
                        </div>
                        <%/each%>
                      </div>
                    </div>
                    <div class="btn rbtn disable"><i class="icon" id="next"></i></div>
                </div>
            </div>

            <div class="sc-fx-area clearfix">
                 <div class="fx-area">
				     <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                     <!--<span class="fx"><i class="icon"></i>分享</span>-->
                     <!--<span class="icon wechat" title="扫一扫分享到微信">-->
                     <!--<img id="qrcode" class="none" data-src="style/img/qrcode822221.jpg" />-->
                     <!--</span>-->
                     <!--<a id="shareSinaWeibo" title="分享到微博" class="icon weibo" href="#"></a>-->
                     <!--<a id="shareQzone" title="分享到QQ空间" class="icon qq" href="#"></a>-->
                 </div>
            </div>
        </div>
    <div class="right-area">
          <h1 class="name"><%goods.title%></h1>
               <div class="price-status">
                  <div class="numa">
                    <div class="num-s" style="width:200px">
                       <d id="stockcontainer">库存:<d id="stock"><%goods.total%></d></d> 已售:<%goods.sales%><%goods.unit%></d>
                    </div>
                  </div>
                <div class="h2-price">
                    <span class="price-title">价格</span>
                    <div class="price-area">
                        ￥ <span class="price"> <%if goods.minprice !=goods.maxprice%><%goods.minprice%> - <%goods.maxprice%><%else%><%goods.marketprice%><%/if%>
                           </span>
                    </div>
                </div>
    
           <%if saleset && saleset.enoughfree=='1' %>
              <div class="other">
                    <div class='left'>
                        <%if saleset.enoughorder<=0%>
                            <span><i class='fa fa-coffee'></i> 全场包邮</span>
                         <%else%>  
                            <span><i class='fa fa-coffee'></i> 单笔订单 满 <span style='color:#ff6600'><%saleset.enoughorder%></span> 元包邮</span>
                          <%/if%>
                    </div>
               </div>
            <%/if%> 

        
        <%if saleset && saleset.enoughs.length>0%>
            <div class="other1">
                <div class='left'>
                    <span><i class='fa fa-birthday-cake'></i> 单笔订单
                </div>
                <div class='right'>
                    <div class='inner'> 
                        <%each saleset.enoughs as e i%><%if i<=1%>满 <span style='color:#ff6600'><%e.enough%></span> 元立减 <span style='color:#ff6600'><%e.money%></span> 元</span>;<br/><%/if%><%/each%>
                        <%if saleset.enoughs.length>2%><span id='morebtn' onclick='showMoreActivity()'><i class='fa fa-angle-down'></i> 查看更多优惠<br/></span><%/if%>
                      <div id='moreactivity' style='display:none'>
                          <%each saleset.enoughs as e i%><%if i>1%>满 <span style='color:#ff6600'><%e.enough%></span> 元立减 <span style='color:#ff6600'><%e.money%></span> 元</span>;<br/><%/if%><%/each%>
                      </div>
                    </div>
               </div>  
            </div>
        <%/if%> 
  
        <%if goods.deduct>0%>
            <div class="other">
                <div class='left'>
                        <span><i class='fa fa-cube'></i> {if $shopset['credit1']}{$shopset['credit1']}{else}积分{/if}抵扣 <span style='color:#ff6600'><%goods.deduct%></span> 元</span>
                </div>
            </div>
        <%/if%> 
        
        <%if goods.isnodiscount=='0' && level.discount>0 && level.discount<10%>
             <div class="other">
                <div class='left'>
                    <i class='fa fa-user'></i> 会员折扣 <span style='color:#ff6600'><%level.discount%></span> 折优惠(<%level.levelname%>)
                </div>
             </div> 
        <%/if%>
    </div>
  <!--  <div class="good_choose_layer"></div>-->
    <div class="good_choose" style="display:block">
       <div class="info" style="display:none;">
             <div class="left">
                 <img id="chooser_img" src='<%goods.thumb%>'/>
             </div>
             <div class="right">
                   <div class="price">￥<span id='option_price'><%goods.marketprice%></span></div>
                   <div class="stock">库存:<span id='option_stock'><%goods.total%></span>件</span> </div>
                   <div class="option">请选择规格</div>
             </div>
            <div class="close" onClick="closechoose()"><i class="fa fa-remove-o"></i></div>
        </div>
        <div class="choose-area">
            <input type='hidden' id='optionid' value='' />
                <%each specs as spec%>
                <input type='hidden' name="optionid[]" class='optionid optionid_<%spec.id%>' value="" title="<%spec.title%>">
                <div class="list-bor" >
                       <div class="spec"><%spec.title%></div>
                    <div class="spec_items options_<%spec.id%>"  title="<%spec.title%>">
                          <%each spec.items as o%>
                          <div class="option option_<%spec.id%>" specid='<%spec.id%>' oid="<%o.id%>" sel='false' title='<%o.title%>' thumb='<%o.thumb%>' style='width: 32px;height: 32px; margin:0px;padding: 1px;'>
                             <%if o.thumb%>
                               <img src="<%o.thumb%>" width="29" height="29" style="width:29px;height:29px;padding:0px;"/>
                             <%else%>
                               <%o.title%>
                             <%/if%>
                          </div>
                         <%/each%>
                    </div>
                </div>
                <%/each%>

                <div id="div-number-area" class="number-area clearfix number" style="width:650px;">
                    <span class="area-title">数量</span>
                    <span class="minus" id='btn_minus' onclick='reduceNum()'>－</span>
                    <input type="text" id="total" value="1" class="rs-ipt" style="height:32px;"/>
                    <span class="plus" onclick='addNum()'>＋</span>
               </div>
               
              <!--  <div id="div-number-area" class="freight-area clearfix" style="width:650px;">
                    <span class="area-title">运费</span>
                    <div class="freight-con">
                        <b class="change-price" xc_no_trans="on">US$6.50</b>
                        <em>&nbsp;to&nbsp;</em>
                        <a onclick="get_shipping(1)" href="javascript:void(0)" xc_no_trans="on">
                        United States via Air Parcel Register<span><i></i></span>
                        </a>
                        <p xc_no_trans="on">10-20 business days</p></div>
                    </div> -->
               </div>
        </div>
        
        <%if goods.canbuy && goods.total!=0 && goods.timebuy=='0' && goods.userbuy=='1' && goods.groupbuy=='1'  && goods.levelbuy=='1'%>
         <div class="btn-area" style="float:left;">
           <%if goods.canaddcart%>
             <span class="btn-addcart btn-o8 " onclick="choose2('cart')">加入购物车</span>
           <%/if%>
           <span class="btn-reserve btn-o8 " id="btn-pc-campaign" onclick="choose2('buy')">立刻购买</span>
         </div>
         <%/if%>
        <div class="ext-area">
                <div class="row"></div>
                <div class="row"><span class="tlt">服务承诺</span><span class="th7 mr15"><i class="icon"></i>7天退换货</span><span class="pzsy"><i class="icon"></i>品质溯源</span></div>
                <div class="row"><span class="tlt">支付方式</span><span title="银行卡" class="icon yhk"></span><span title="支付宝" class="icon zfb"></span><span title="微信" class="icon wx"></span><span title="银联" class="icon yl"></span></div>
                <div class="row">
                    <span class="tlt">温馨提示</span>
                    <ul>
                                <li>目标10件，达到即可开始制作，期待你的支持！</li>
                        <li>这是毫无风险的预订：假如活动未成功，你预订时支付的费用将在活动结束后的一个工作日内返还到你的支付账户。假如在活动进行中时，你想取消预订，可以随时取消！</li>
                            <li>预计发货时间：<span class="fhsj">
                            	<?php echo date("Y-m-d",strtotime("+1 day"));?>
                            </span>左右。</li>
                    </ul>
                </div>
            </div>
        
       	<!--<div class="sub " onClick="choose2()">确认</div> -->
    </div>
    
        <div class="good_bottom" style="display:none;">
            <div class="like" >
                <i class="fa <%if isfavorite%>fa-star<%else%>fa-star-o<%/if%>" <%if isfavorite==1%>style="color:#f90"<%/if%>></i>
                <br><span>收藏</span>
            </div>
            {if $this->yzShopSet['cservice']}
            <div class="cs" ><i class="fa fa-headphones"></i><br><span>客服</span></div>
            {/if}
        </div>
        
      </div>
    </div>

      <%if goods.isverify=='2'%>
     <div class="good_speci" onclick="showStores(this)" show="1">适用的门店
         <i class="fa fa-angle-down" style="float:right; line-height:44px; font-size:26px;"></i>
     </div>
      <div>
     <%each stores as store index%>
     <%if index<=1%>
     <div class="store" >
             <div class="info">
             <div class="ico"><i class="fa fa-building-o"></i></div>
             <div class='info1'>
                 <div class='inner'>
                     <div class="user"><%store.storename%></div>
                     <div class="address">地址: <%store.address%></div>
                     <div class="tel">电话: <%store.tel%></div>
                 </div>
             </div>
             <a href="http://api.map.baidu.com/marker?location=<%store.lat%>,<%store.lng%>&title=<%store.storename%>&name=<%store.storename%>&content=<%store.address%>&output=html"><div class="ico2"><i class='fa fa-map-marker'></i></div></a>
             <a href="tel:<%store.tel%>"><div class="ico3" ><i class='fa fa-phone'></i></div></a>
        </div>
       </div>
     <%/if%>
     <%/each%> 
     <div id='store_more' style="display:none">
      <%each stores as store index%>
     <%if index>1%>
     <div class="store" >
             <div class="info">
             <div class="ico"><i class="fa fa-building-o"></i></div>
             <div class='info1'>
                 <div class='inner'>
                     <div class="user"><%store.storename%></div>
                     <div class="address">地址: <%store.address%></div>
                     <div class="tel">电话: <%store.tel%></div>
                 </div>
             </div>
             <a href="http://api.map.baidu.com/marker?location=<%store.lat%>,<%store.lng%>&title=<%store.storename%>&name=<%store.storename%>&content=<%store.address%>&output=html"><div class="ico2"><i class='fa fa-map-marker'></i></div></a>
             <a href="tel:<%store.tel%>"><div class="ico3" ><i class='fa fa-phone'></i></div></a>
        </div>
       </div>
     <%/if%>
     <%/each%> 
     </div>
    <%if stores.length>=3%>
     <div class="store_more" onclick="$('#store_more').show();$(this).remove()">显示更多 <i class="fa fa-angle-double-down"></i></div>
     <%/if%>
      </div>
     <%/if%>
         <div class="shop-head-ct clearfix">
                <div class="shop-area">
                    <div class="shop-photo">
                            <img width="80" height="80" src="{$supplier_info['avatar']}">
                    </div>
                    <div class="shop-name">
                        <span>{$supplier_info['nickname']}</span>
                    </div>
                    <div class="shop-btn">
                        <span class="act-num"><em class="icon e1">&nbsp;</em>点击数：{$supplier_info['clickcount']}</span>
                        <!-- <span class="fans-num"><em class="icon e2">&nbsp;</em>粉丝数：241</span> -->
                        <a target="_blank" href="{php echo $this->createMobileUrl('shop/list',array('op'=>'myshop','supplier_uid'=>$supplier_info['supplier_uid']))}" class="enter-shop btn-s1 btn-o8">进店逛逛</a>
                    </div>
                </div>
                <div class="shop-cp">
                    <p class="txt">
                        爱我所爱！
                    </p>
                </div>
         </div>
         
         <div class="zgtj">
            <h4>掌柜推荐</h4>
            <div id="div-recommend"></div>
        </div>
        <div class="detail">
            <div class="dt-tlt">
                商品详情<span>PRODUCT DETAILS</span>
            </div>
            <div class="desc-area">
                <div class="desc" id="div-description"></div>
                <%=goods.content%>
            </div>
        </div>
        <div class="zgtj">
            <h4>猜你喜欢</h4>
            <div id="div-cnxh-ct" class="zgtj-ct">
                <div id="div-cnxh"></div>
            </div>
        </div>
        
</div>
   <!--<div id="buytime" class="good_speci" style="display:none"></div>
   <div id="notbuy" class="good_speci" style="display:none"></div>
   
   <%if goods.canbuy && goods.total!=0 && goods.timebuy=='0' && goods.userbuy=='1'  && goods.groupbuy=='1'  && goods.levelbuy=='1'%> 
    <div class="good_speci" onClick="choose()">
                <span id="optiondiv">请选择商品规格及数量</span>
                <i class="fa fa-angle-right" style="float:right; line-height:44px; font-size:26px;"></i>
    </div>
     <%/if%>
       
    <div class="good_info2">
        <div class="menu">
            <div id="nav_1" class="nav navon" onClick="tab(1)">图文详情</div>
            <div id="nav_2" class="nav" onClick="tab(2)">产品参数</div>
            <div id="nav_3" class="nav" onClick="tab(3)">用户评价</div>
            <div id="nav_4" class="nav" onClick="tab(4)" style="border-right:0px; width:24%">同店推荐</div>
        </div>
        <div class="tab_con">
            <div class="con" id="con_1"  style='display:block'><%=goods.content%></div>
            <div class="con" id="con_2">
                <%if params.length<=0%>
                 无任何产品参数
                <%/if%>
                <%each params as value%>
                <p class='param'><%value.title%>: <%value.value%> </p>
                <%/each%>
            </div>
            <div class="con" id="con_3" ><div id='comment_container'></div></div>
            <div class="con" id="con_4"><div id='recommand_container'></div></div>
        </div>
    </div>
</script>
<script id='tpl_comment' type='text/html'>
    <%each list as comment%>
    <div class='comment'>
        <div class="pj-imgpos">
            <div class='head-img'><img src='<%comment.headimgurl%>'/></div>
            <div class='nickname'><div class='inner'><%comment.nickname%>杨小猫</div></div>
        </div>
                    <div class='info'>
                        
                        <div class='level'>
                            <%if comment.level>=1%><i class='fa fa-star'></i><%else%><i class='fa fa-star-o'></i><%/if%>
                            <%if comment.level>=2%><i class='fa fa-star'></i><%else%><i class='fa fa-star-o'></i><%/if%>
                            <%if comment.level>=3%><i class='fa fa-star'></i><%else%><i class='fa fa-star-o'></i><%/if%>
                            <%if comment.level>=4%><i class='fa fa-star'></i><%else%><i class='fa fa-star-o'></i><%/if%>
                            <%if comment.level>=5%><i class='fa fa-star'></i><%else%><i class='fa fa-star-o'></i><%/if%>
                            </div>
                    </div>
                    <div class='content'><%comment.content%></div>
                    <%if comment.images.length>0%>
                       <div class='imgs'>
                          <%each comment.images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>
                    </div>
                    <%/if%>
                   <%if comment.reply_content!=''%>
                         <div class='content' style='margin-top:5px;'><span style='color:#ff6600'>[回复]</span><%comment.reply_content%></div>
                        <%if comment.reply_images.length>0%>
                            <div class='imgs'>
                               <%each comment.reply_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>
                         </div>
                   <%/if%>
                      <%/if%>
              
                     <%if comment.append_content!=''%>
                         <div class='content' style='margin-top:5px;border-top: 1px dashed #E4E4E4;'><span style='color:#ff6600'>[追加]</span><%comment.append_content%></div>
                        <%if comment.append_images.length>0%>
                            <div class='imgs'>
                               <%each comment.append_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>
                         </div>
                      <%/if%>
                     <%/if%>
                
                  <%if comment.append_reply_content!=''%>
                         <div class='content' style='margin-top:5px;'><span style='color:#ff6600'>[回复]</span><%comment.append_reply_content%></div>
                        <%if comment.append_reply_images.length>0%>
                            <div class='imgs'>
                               <%each comment.append_reply_images as img%><img src='<%img%>' style='width:30px;height:30px;' /><%/each%>
                         </div>
                      <%/if%>
                     <%/if%>
             <div class='time'><%comment.createtime%></div>
     </div>
     <%/each%>
</script>
<script id='tpl_recommand' type='text/html'>
     <%each list as g%>
    <div class="good" data-goodsid='<%g.id%>'>
        <img src='<%g.thumb%>'/>
        <div class="name"><%g.title%></div>
        <div class="price">￥<%g.marketprice%> <%if g.productprice>0 && g.marketprice!=g.productprice%><span>￥<%g.productprice%></span><%/if%></div>
    </div>
    <%/each%>
</script>

<script id="tpl_img" type="text/html">
    <div class='img' data-img='<%filename%>'>
        <img src='<%url%>' />
        <div class='minus'><i class='fa fa-minus-circle'></i></div>
    </div>
</script>

<script language="javascript">
    function showMoreActivity(){
        $('#morebtn').hide();
        $("#moreactivity").fadeIn();
    }

    var hasoption = false;
    var maxbuy = 0;
    var options = [];
    var specs = [];
    var tip = null;
    var action="";
    var alpha = 0;

    
    
    function share(){

        $('#cover').fadeIn(200).unbind('click').click(function(){
            $(this).fadeOut(100);
        })
    }
    function menu(obj){
       
        if($(obj).attr('show')=='1'){
            $(obj).removeAttr('show');
            $('.sort_list').fadeOut(200);
        }else{
            $(obj).attr('show','1');  
            $('.sort_list').fadeIn(200);
        }
    }

    $(function(){
        $(document.body).click(function(e){
           var classname = "";
           
            if($(e.target).get(0) ){
                classname =$(e.target).get(0).className;
            }
            if(classname!='fa fa-ellipsis-v' && classname!='btn func') {
                
                $('.func').removeAttr('show');
                $('.sort_list').fadeOut(200);
            }
        });
    })
    function showStores(obj){
        if($(obj).attr('show')=='1'){
            $(obj).next('div').slideUp(100);
            $(obj).removeAttr('show').find('i').removeClass('fa-angle-down').addClass('fa-angle-up');
        }
        else{
            $(obj).next('div').slideDown(100);
            $(obj).attr('show','1').find('i').removeClass('fa-angle-up').addClass('fa-angle-down');
        }
    }
    require(['tpl', 'core','jquery.touchslider','swipe'], function(tpl, core) {

        function setTimer(goods){
            setTimeHtml(goods);
            window.timer = setInterval(function(){
                setTimeHtml(goods);
            },1000);
        }

        function setTimeHtml(goods){
            var current = Math.floor(new Date().getTime()/1000);
            var ts = 0;//计算剩余的毫秒数
            var prefix = '';
            
            if(goods.timestate=='before'){
                ts = goods.timestart - current;
                prefix = "限时购开始倒计时: ";
                if(ts<=0){
                    location.reload();
                }
            }
            else if(goods.timestate=='after'){
                ts = goods.timeend - current;
                
                prefix = "限时购结束倒计时:  ";
                if(ts<=0){
                    location.reload();
                }
            }
            var dd = parseInt(ts / 60 / 60 / 24, 10);//计算剩余的天数
            var hh = parseInt(ts  / 60 / 60 % 24, 10);//计算剩余的小时数
            var mm = parseInt(ts  / 60 % 60, 10);//计算剩余的分钟数
            var ss = parseInt(ts % 60, 10);//计算剩余的秒数
            dd = checkTime(dd);
            hh = checkTime(hh);
            mm = checkTime(mm);
            ss = checkTime(ss);
            $('.timestate').html(prefix+ "<span>" + dd + "</span>天<span>" + hh + "</span>时<span>" + mm + "</span>分<span>" + ss + "</span>秒");
        }


        function checkTime(i){
            if (i < 10) {    
                i = "0" + i;    
            }
            return i;    
        } 

        core.json('shop/detail',{id:'{$_GPC['id']}',mid:"{$mid}"},function(json){
            tip = core.tip;
            if(json.status<=0){
                core.message('没有找到您想要的宝贝哦~',"{php echo $this->createMobileUrl('shop/list')}",'error');
                return;
            }
            
            $(window).scroll(function(){
         
                var top = $(document).scrollTop() ;
                alpha = top/270 ;
                if(alpha>0.5){
                    alpha = 0.5;
                }
                $('.good_topbar').css("background","rgba(237,237,237,"+ alpha + ")");
                $('.good_topbar .btn').css("background","rgba(237,237,237,"+ (0.5-alpha) + ")");
            });
            $('body').on("touchmove",function(){
                
                var top = $(document).scrollTop() ;
                alpha = top/270 ;
                if(alpha>0.6){
                    alpha = 0.6;
                }
                $('.good_topbar').css("background","rgba(237,237,237,"+ alpha + ")");
                $('.good_topbar .btn').css("background","rgba(237,237,237,"+ (0.6-alpha) + ")");
            });
        
            $('#mainbody').html(  tpl('goods_info',json.result) ); 

            $(".imgList img").bind("click",function(){
            var big_img = this.getAttribute("src");
            $(".show-img img").attr('src',big_img);
            });
            var curIndex = 0, //当前index
            imgLen = $(".imgList img").length; //图片总数
            // 定时器自动变换2.5秒每次
           

            //左箭头滑入滑出事件处理
            $("#prev").hover(function(){ 
              //滑入清除定时器
              //clearInterval(autoChange);
            },function(){ 
              //滑出则重置定时器
              autoChangeAgain();
            });
            //左箭头点击处理
            $("#prev").click(function(){ 
              //根据curIndex进行上一个图片处理
              curIndex = (curIndex > 0) ? (--curIndex) :  curIndex++;

              if (curIndex == imgLen-4) {
             curIndex++
            }
              changeTo(curIndex);
            });

            //右箭头滑入滑出事件处理
             $("#next").hover(function(){ 
               //滑入清除定时器
               //clearInterval(autoChange);
             },function(){ 
               //滑出则重置定时器
               autoChangeAgain();
             });
             //右箭头点击处理
            $("#next").click(function(){ 
            curIndex = (curIndex < imgLen - 1) ? (++curIndex) : --curIndex;
            if (curIndex == imgLen-4) {
             --curIndex
            }
            changeTo(curIndex);
            });
            

            function changeTo(num){ 
            var goLeft = num * 90;
            $(".imgList").animate({left: "-" + goLeft + "px"},500);
            }


            var bh = $(document.body).height() - 50;
            $('.good_choose').css('max-height',bh); 
            $('.good_choose .other').css('max-height',bh-175);

            // alert(document.body.clientWidth);
            //$('.good_img').height( document.body.clientWidth + "px");
              
            $('#con_1 img,#con_1 table,#con_1 div').width('100%');
            var ua = navigator.userAgent.toLowerCase();
            var isWX = ua.match(/MicroMessenger/i) == "micromessenger";
            var z = []; 
            $(".main_image img").each(function() {
                z.push($(this).attr("src"));
            });
            var current;
            if (isWX) {
                $(".main_image img").click(function(e) {
                    e.preventDefault();
                    var startingIndex = $(".main_image img").index($(e.currentTarget));
                    var current = null;
                    $(".main_image img").each(function(B, A) {
                        if (B === startingIndex) {
                            current = $(A).attr("src");
                        }
                    });
                    WeixinJSBridge.invoke("imagePreview", {
                        current: current,
                        urls: z
                    });
                });
            }
            
            var z1 = []; 
            $("#con_1 img").each(function() {
                z1.push($(this).attr("src"));
            });
            var current1;
            if (isWX) {
                $("#con_1 img").click(function(e) {
                    e.preventDefault();
                    var startingIndex = $("#con_1 img").index($(e.currentTarget));
                    var current = null;
                    $("#con_1 img").each(function(B, A) {
                        if (B === startingIndex) {
                            current1 = $(A).attr("src");
                        }
                    });
               
                    WeixinJSBridge.invoke("imagePreview", {
                        current: current1,
                        urls: z1
                    });
                });
            }
            
      
            
            document.title = json.result.goods.title;
            hasoption = json.result.options.length>0;
            goods = json.result.goods;
            maxbuy = json.result.goods.maxbuy;
            options = json.result.options;
            specs = json.result.specs;

            nothtml = "";
            timehtml = "";
            hastime = false;
            if( goods.canbuy){

                if(goods.userbuy=='0') {
                    nothtml = "您已超出购买上限~";
                } else {
                    if( goods.groupbuy=='0' || goods.levelbuy=='0'){
                        nothtml="您不能购买此商品,请联系客服";
                    } else {
                        if( goods.total==0){
                            nothtml="库存不足，无法购买";
                        } else {
                            if( goods.istime=='1'){
                                if( goods.timebuy=='1'){
                                    nothtml= "限时购活动已经结束，请下次再来~"
                                }else{//未开始倒计时或进行中
                                    nothtml='<span class="timestate"></span>';
                                    hastime = true;
                                }
                            }
                        }
                    }

                }
                if( goods.istime=='1'){
                    if( goods.timebuy!='1'){

                        timehtml = '<span class="timestate"></span>';
                    }
                }
                     
            }else{
                nothtml = "商品已下架";
            }
            if( goods.levelshow=='0' || goods.groupshow=='0'){
                nothtml="您不能浏览此商品,请联系客服";
            }
            //nothtml="您不能浏览此商品,请联系客服";
            if( nothtml!=''){
                $('#notbuy').html(nothtml).show();
            }
            if( timehtml!='' && !hastime){
                $('#buytime').html(timehtml).show();
            }
            if($('.timestate').length>0) {
                if(goods.timestate!=''){
                    setTimer(goods);
                }
            }
            

            if(options.length>0){
                $('#productpricecontainer').html('');
            }

            $('#total').blur(function(){
                var total = $("#total");
                if(!total.isInt()){
                total.val("1");
                       return;
                }
                if(parseInt(total.val())<=0){
                    total.val("1");
                    return;
                } 
                var stock = $("#stock").html()==''?-1:parseInt($("#stock").html());
                var num = parseInt(total.val() );
                if(num>maxbuy && maxbuy>0){
                    tip.show("您最多可购买 " + maxbuy + " 件!");
                    num = maxbuy;
                }
                else if(num>stock && stock!=-1){
                    tip.show("您最多可购买 " + stock + " 件");
                    num = stock;
                }
    
                total.val(num);
            });
 
               
            new Swipe($('.main_image')[0], {
                speed:300,
                auto:4000,
                callback: function(){
                    $(".flicking_con  .inner  a").removeClass("on").eq(this.index).addClass("on");
                }
            });
            {if !empty($formInfo)}
                {template 'diyform/common_js'}
            {/if}

            $(".option").click(function() {
                var specid = $(this).attr("specid");
                var oid = $(this).attr("oid");
                $(".optionid_"+specid).val(oid);
                $(".options_" + specid + "  .option").removeClass("on").attr("sel", "false");
                $(this).addClass("on").attr("sel", "true");

                var titles='已选: ';

                $('.spec_items').each(function(){
                    if($(this).find('.on').length>0){
                        titles+= $(this).find('.on').attr('title')+";";   
                    }
                });
                $('.good_choose .info .right .option').html(titles);
                var thumb = $(this).attr('thumb');
                if(thumb!=''){
                    $("#chooser_img").attr('src',thumb);
                }
                else{
                    $("#chooser_img").attr('src',json.result.goods.thumb);
                }
                setoptions();
                var optionid = "";
                var stock =0;
                var marketprice = 0;
                var productprice = 0;
                var ret = option_selected();

                if(ret.no==''){
                    var len = options.length;
                    for(var i=0;i<len;i++) {
                        var o = options[i];
                        var ids = ret.all.join("_");
                        var specarr = o.specs.split('_').sort();
                        var idsarr = ret.all.sort();                                
                        if(specarr.join('_') ==idsarr.join('_') ){
                            optionid = o.id;
                            stock = o.stock;
                            marketprice = o.marketprice;
                            productprice = o.productprice;
                            break;
                        }
                    }
                    $("#optionid").val(optionid); 
                         var num = parseInt($("#total").val() );

                        if(num>maxbuy && maxbuy>0){

                            tip.show("您最多可购买 " + maxbuy + " 件!");
                            num = maxbuy;
                        }
                        else if(num>stock && stock!=-1){
                            tip.show("您最多可购买 " + stock + " 件");
                            num = stock;
                        }
                        $("#total").val(num); 
                    
                    if(stock!="-1"){
                        $("#stockcontainer").html("库存:<span id='stock'>" + stock + "</span>");
                    }
                    else{
                      $("#stockcontainer").html("<span id='stock'></span>");
                    }
                    if(ret.no==''){
                        if(stock==0){
                            $('.sub').addClass('disabled').html('库存不足,无法购买');
                        }
                        else{
                            $('.sub').removeClass('disabled').html('确认');
                        }
                    } 
                    $("#marketprice").html(marketprice);
                    
                    $("#option_price").html(marketprice);   
                    $("#option_stock").html(stock); 
                     
                    $("#productprice").html(productprice);
                    if(productprice<=0){
                        $('#productpricecontainer').html("");
                    }
                    else{
                        $('#productpricecontainer').html("市场价￥<span id='productprice'>" + productprice + "</span>");
                    }
                }
            });

        $('.cs').click(function(){
            location.href='{php echo $this->yzShopSet['cservice']}&metadata={"name":"{php echo $member['realname']}","tel":"{php echo $member['mobile']}","address":"{php echo $member['province']}"}';
        });
                
           
        $('.like').click(function(){
            var self = $(this);
            require(['core'],function(core){
               core.json('shop/favorite',{op:'set', id:'{$_GPC['id']}'},function(ret){
                    if(ret.status==1){
        
                        if(ret.result.isfavorite){
                           self.find('i').removeClass('fa-star-o').addClass('fa-star').css('color','#f90');
                        }
                        else{
                           self.find('i').addClass('fa-star-o').removeClass('fa-star').css('color','#999');
                        }
                   }
                   else{
                       core.tip.show('操作失败');
                   }
               });
              },false,true);
        });
        var page = 1;
        function bindCommentImages(){
        var z = []; 
        $(".comment .imgs img").each(function() {
            z.push($(this).attr("src"));
        });
        var current;
        if (isWX) {
            $(".comment .imgs  img").click(function(e) {
                e.preventDefault();
                var startingIndex = $(".comment .imgs  img").index($(e.currentTarget));
                var current = null;
                $(".comment .imgs  img").each(function(B, A) {
                    if (B === startingIndex) {
                        current = $(A).attr("src");
                    }
                });
                WeixinJSBridge.invoke("imagePreview", {
                    current: current,
                    urls: z
                });
            });
        }
        }
                $('#nav_3').click(function(){
                    page = 1;
                     core.json('shop/util',{op:'comment', page:page,goodsid:'{$_GPC['id']}'},function(json){
                         if(json.result.list.length<=0){
                             $('#comment_container').html('暂时没有任何评价');
                             return;
                         }
                         $('#comment_container').html( tpl('tpl_comment',json.result));
                       bindCommentImages();
                            var loaded = false;
                              var stop=true; 
                              $(window).scroll(function(){ 
                                  if(loaded){
                                      return;
                                  }
                                    totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 
                                    if($(document).height() <= totalheight){ 

                                        if(stop==true){ 
                                            stop=false; 
                                            $('#comment_container').append('<div id="comment_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
                                            page++;
                                            core.json('shop/util', {op:'comment',page:page,goodsid:'{$_GPC['id']}'}, function(morejson) {  
                                                stop = true;
                                                $('#comment_loading').remove();
                                                $("#comment_container").append(tpl('tpl_comment', morejson.result));
                                                  bindCommentImages();
                                                if (morejson.result.list.length <morejson.result.pagesize) {

                                                    $("#comment_container").append('<div id="comment_loading">已经加载完全部评价</div>');
                                                    loaded = true;
                                                    $(window).scroll = null;
                                                    return;
                                                }
                                            },true); 
                                        } 
                                    } 
                                });
                     });
                 });
                 
                 $('#nav_4').click(function(){
                      core.json('shop/util',{op:'recommand'},function(json){
                         if(json.result.list.length<=0){
                             $('#recommand_container').html('暂时没有同店推荐');
                             return;
                         }
                         $('#recommand_container').html( tpl('tpl_recommand',json.result));
                         $('#recommand_container .good').click(function(){
                            location.href = core.getUrl('shop/detail',{id:$(this).data('goodsid') });
                         }).find('img').each(function(){
                             $(this).height($(this).width());
                         });
                         
                     });
                 });
        },true);
        
    })
</script> 

<script type="text/javascript">
    function tab(n){
        $('#con_'+n).fadeIn();
        $('#con_'+n).siblings().hide();
        $('#nav_'+n).addClass('navon');
        $('#nav_'+n).siblings().removeClass('navon');
                      
    }
    function closechoose(){
        $('.good_choose_layer').fadeOut(100);
        $('.good_choose').fadeOut(100); 
    }



    function choose(act){
 
        if($('#followed').val()=='0'  && $('#needfollow').val()=='1' ){
            require(['core'],function(core){
                core.tip.confirm($('#followtip').val(),function(){
                    location.href = $('#followurl').val();
                    return;
                }) 
            });
        return;
        }

        action = act;
        if(!action){
                                     
            $('.good_choose_layer').fadeIn(200);
            $('.good_choose_layer').unbind('click').click(function(){
                $('.good_choose_layer').fadeOut(100);
                $('.good_choose').fadeOut(100); 
            })
            $('.good_choose').fadeIn(200);
                return;
        }
        var specselected  = '';



        if( action=='cart'){
            $('.good_choose_layer').fadeIn(200);
            $('.good_choose_layer').unbind('click').click(function(){
                closechoose();
            })
            $('.good_choose').fadeIn(200);
            return;  
        }else{

            {if !empty($formInfo)}
                $('.good_choose_layer').fadeIn(200);
                $('.good_choose_layer').unbind('click').click(function(){
                    closechoose();
                })
                $('.good_choose').fadeIn(200);
                return;
            {/if}
             
            $('.spec_items').each(function(){
                var self = $(this);
                if( $(this).find('.on').length<=0){
                    specselected = self.attr('title');
                    return false;
                }
            });  
            if(specselected!='') {
                $('.good_choose_layer').fadeIn(200);
                $('.good_choose_layer').unbind('click').click(function(){
                    closechoose();
                })
                $('.good_choose').fadeIn(200);
                return;
            }
            
        }
       
        var diymode = {php echo intval($diymode)};

        if(specselected!='' || diymode==1) {
            if (specselected == '') {
                $('#goods_spec').hide();
            }

            $('.good_choose_layer').fadeIn(200);
            $('.good_choose_layer').unbind('click').click(function(){
            closechoose();
                })
            $('.good_choose').fadeIn(200);
        } else{
            if(action=='cart'){
                require(['core'],function(core){

                    core.json('shop/cart',{op:'add', id:'{$_GPC['id']}',optionid:$('#optionid').val(),total:$('#total').val()},function(ret){
                        if(ret.status==1){
                            core.tip.show(ret.result.message);
                            var cartdiv = $('.cart');
                            if( cartdiv.find('b').length<=0){
                                cartdiv.append('<b>'+ ret.result.cartcount +"</b>");
                            }
                            else {
                                cartdiv.find('b').html(ret.result.cartcount);
                            }
                        } else if(ret.status==2){
                             core.tip.show(ret.result.message);
                             location.href=ret.result.url;
                        } else{
                            core.message(ret.result,'','error');
                        }
                    },true,true);
                });
            }else if(action=='buy'){
                location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val();
            }

        }
    }
        




    function setoptions(){
        var titles = '';
        if(hasoption){

            titles+='已选: ';
            $('.spec_items').each(function(){
                titles+= $(this).find('.on').attr('title')+";";   
            });
        }
        titles+='数量:' + $('#total').val();
        $("#optiondiv").html(titles);
    }




    function choose2(direct,close){
        require(['core'],function(core){
            if(close){
                //closechoose();
                return;
            }
            if(!direct){
                if($('.sub').hasClass('disabled')){
                    return;
                }
                else{
                    setoptions();
                }
            } else {
                action = "";
            }
            var specselected  = '';
            $('.spec_items').each(function(){
                var self = $(this);
                if( $(this).find('.on').length<=0){
                    specselected = self.attr('title');
                    return false;
                }
            });  
            if( specselected!=''){
                require(['core'],function(core){
                    core.tip.show('请选择' + specselected) ;
                });
                return;
            }           
            if(direct=='cart'){
                var data = {};
                {if !empty($formInfo)}
                    {template 'diyform/common_js_data'}
                    data = {
                        'diyformid': "{$goods['diyformid']}",
                        'diydata':diydata
                    };
                {/if}
                var gstock = $("#stock").html();
                if($('#total').val() > gstock){
                    $('#total').val(gstock);
                }
                core.json('shop/cart',{op:'add', id:'{$_GPC['id']}',optionid:$('#optionid').val(),total:$('#total').val(),diyformdata:data},function(ret){

                    if(ret.status==1){ 
                        core.tip.show(ret.result.message);
                        var cartdiv = $('.cart');
                        if( cartdiv.find('b').length<=0){
                            cartdiv.append('<b>'+ ret.result.cartcount +"</b>");
                        }
                        else {
                            cartdiv.find('b').html(ret.result.cartcount);
                        }
                        //closechoose();

                    } else if(ret.status==2){
                        core.tip.show(ret.result.message);
                        location.href=ret.result.url;
                    }else{
                        core.message(ret.result,'','error');
                    }
                },true,true);
                                            
            }else if(direct=='buy'){
            // var gstock = $("#stock").html();
            //     if($('#total').val() > gstock){
            //         $('#total').val(gstock);
            //     }
                {if !empty($formInfo)}
                    {template 'diyform/common_js_data'}

                    var data ={
                        'op': 'create',
                        'id': {$_GPC['id']},
                        'diydata': diydata
                    };

                     var gstock = $("#stock").html();
                		if($('#total').val() > gstock){
                    	$('#total').val(gstock);
                	}

                    require(['core'],function(core){
                        core.json('shop/detail', data, function(create_json) {
                            if (create_json.status == 1) {

                                location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val()+ "&gdid="+create_json.result.goods_data_id;
                            } else {
                                core.tip.show("提交失败!")
                            }

                        return false;

                        }, true, true);
                    })

                    {else}

                        location.href = "{php echo $this->createMobileUrl('order/confirm')}&id={$_GPC['id']}&optionid=" +$("#optionid").val() + "&total=" + $("#total").val();
                {/if}

            } else {
                //closechoose();
            }
        });
    }

  function addNum(){
    var total = $("#total");
    /*if(!total.isInt()){
        total.val("1");
    }*/
    var stock = $("#stock").html()==''?-1:parseInt($("#stock").html());
    var num = parseInt(total.val() ) + 1;
        if(num>maxbuy && maxbuy>0){
        tip.show("您最多可购买 " + maxbuy + " 件!");
        num = maxbuy;
    }
    else if(num>stock && stock!=-1){
        tip.show("您最多可购买 " + stock + " 件");
        num = stock;
    }
    total.val(num);
}
function reduceNum(){
    var total = $("#total");
    /*if(!total.isInt()){
        total.val("1");
    }*/
    var num = parseInt( total.val() );
    if(num-1<=0){
        return;
    }
    num--;
    total.val(num);
}

    function option_selected(){
        var ret= {
            no: "",
            all: []
        };
        if(!hasoption){
            return ret;
        }
        $(".optionid").each(function(){
            ret.all.push($(this).val());
            if($(this).val()==''){
                ret.no = $(this).attr("title");
                return false;
            }
        })
        return ret;
    }
</script>

{template 'common/footer'}
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>